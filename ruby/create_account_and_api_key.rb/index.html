<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>create_account_and_api_key.rb - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/ruby/create_account_and_api_key.rb/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-88235803-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>November 23, 2017<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest">SoftLayer_Virtual_Guest</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Account">SoftLayer_Account</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Brand">SoftLayer_Brand</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_User_CustomerInitParameters">SoftLayer_User_CustomerInitParameters</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/brands">brands</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>create_account_and_api_key.rb</h1>
                    <small>create_account_and_api_key.rb</small>
                </div>
				
                
				
                <div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># Creates new account and create API key for that account
#
# The script creates a new account using the createCustomerAccount() method,
# then the script will create the API key for that account, in order to achieve
# that goal it is necessary to make soap request because in oder to create
# the API key we need to call the method addApiAuthenticationKey() using the
# the credentials of the new account as we do not have that information we are
# calling the method using impersonation.
# For perform the impersonation we need the userId and the token for the authentication.
# For more details please see below.
#
# Important manual pages
# http://sldn.softlayer.com/reference/services/SoftLayer_Account/addApiAuthenticationKey
# http://sldn.softlayer.com/reference/services/SoftLayer_Account/getApiAuthenticationKeys
# http://sldn.softlayer.com/reference/services/SoftLayer_Account/getOwnedBrands
# http://sldn.softlayer.com/reference/datatypes/SoftLayer_Account/
# http://sldn.softlayer.com/reference/datatypes/SoftLayer_Brand/
# http://sldn.softlayer.com/reference/services/SoftLayer_Brand
# http://sldn.softlayer.com/reference/services/SoftLayer_Brand/createCustomerAccount
# http://sldn.softlayer.com/reference/services/SoftLayer_Brand/getUsers
# http://sldn.softlayer.com/reference/services/SoftLayer_Brand/getToken
#
# License: http://sldn.softlayer.com/article/License
# Author: SoftLayer Technologies, Inc.&lt;sldn@softlayer.com&gt;
require &#39;softlayer_api&#39;
require &#39;pp&#39;

# Your SoftLayer API username and key.
USERNAME = &#39;set me&#39;
API_KEY = &#39;set me&#39;
ENDPOINT = &#39;set me&#39;

# Declaring the API client to use the SoftLayer_Virtual_Guest API service
client = SoftLayer::Client.new(
  username: USERNAME,
  api_key: API_KEY,
  endpoint_url: ENDPOINT
)

brand_service = client.service_named(&#39;SoftLayer_Brand&#39;)
account_service = client.service_named(&#39;SoftLayer_Account&#39;)

begin
  # Getting the brand for our account
  # the account could belong to several brands
  # you need to select one brand for the new account.
  brands = account_service.getOwnedBrands

  # Creating an SoftLayer_Account object which contains the data
  # of our new account.
  account_template = {
    &#39;address1&#39; =&gt; &#39;8200 Warden Ave&#39;,
    &#39;city&#39; =&gt; &#39;Markham&#39;,
    &#39;companyName&#39; =&gt; &#39;IBM Bluemix Dedicated&#39;,
    &#39;email&#39; =&gt; &#39;email@softlayer.com&#39;,
    &#39;firstName&#39; =&gt; &#39;FirstName&#39;,
    &#39;lastName&#39; =&gt; &#39;Surename&#39;,
    &#39;officePhone&#39; =&gt; &#39;number&#39;,
    &#39;postalCode&#39; =&gt; &#39;L6G 1C7&#39;,
    &#39;state&#39; =&gt; &#39;TX&#39;,
    &#39;brandId&#39; =&gt; brands[0][&#39;id&#39;],
    &#39;country&#39; =&gt; &#39;CA&#39;
  }

  # Creating the new account
  new_account = brand_service.createCustomerAccount(account_template)

  # Looking for the master user for the new account
  new_master_user = nil
  users = brand_service.object_with_id(brands[0][&#39;id&#39;]).getUsers
  users.each do |user|
    if user[&#39;accountId&#39;] == new_account[&#39;id&#39;]
      new_master_user = user
      break
    end
  end

  # Getting the token
  token = brand_service.object_with_id(brands[0][&#39;id&#39;]).getToken(new_master_user[&#39;id&#39;])

  print token # This is the token you need to send to the SOAP request
  print &#39;  &#39;
  print new_master_user[&#39;id&#39;] # This is the userId you need to send to the SOAP request

rescue StandardError =&gt; exception
  puts &#34;Unable to create the new account : #{exception}&#34;
end

# Here call the soap methods

=begin
This is a soap example to create the API key to the account.
It will create the API key for the master account of the new account.
In case the master account already has an API key the request will return an error.
Please replace the values $TOKEN and $USERID

&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&#34;http://schemas.xmlsoap.org/soap/envelope/&#34; xmlns:ns1=&#34;http://api.service.softlayer.com/soap/v3/&#34; xmlns:xsd=&#34;http://www.w3.org/2001/XMLSchema&#34; xmlns:SOAP-ENC=&#34;http://schemas.xmlsoap.org/soap/encoding/&#34; SOAP-ENV:encodingStyle=&#34;http://schemas.xmlsoap.org/soap/encoding/&#34;&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;ns1:clientLegacySession&gt;
      &lt;userId&gt;$USERID&lt;/userId&gt;
      &lt;authToken&gt;$TOKEN&lt;/authToken&gt;
    &lt;/ns1:clientLegacySession&gt;
    &lt;ns1:SoftLayer_User_CustomerInitParameters&gt;
      &lt;id&gt;$USERID&lt;/id&gt;
    &lt;/ns1:SoftLayer_User_CustomerInitParameters&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:addApiAuthenticationKey/&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;

You Also can execute this SOAP request to get the APIKey of the master account
Note: The user should already has the APIKey created

&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&#34;http://schemas.xmlsoap.org/soap/envelope/&#34; xmlns:ns1=&#34;http://api.service.softlayer.com/soap/v3/&#34; xmlns:xsd=&#34;http://www.w3.org/2001/XMLSchema&#34; xmlns:SOAP-ENC=&#34;http://schemas.xmlsoap.org/soap/encoding/&#34; SOAP-ENV:encodingStyle=&#34;http://schemas.xmlsoap.org/soap/encoding/&#34;&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;ns1:clientLegacySession&gt;
      &lt;userId&gt;$USERID&lt;/userId&gt;
      &lt;authToken&gt;$TOKEN&lt;/authToken&gt;
    &lt;/ns1:clientLegacySession&gt;
    &lt;ns1:SoftLayer_User_CustomerInitParameters&gt;
      &lt;id&gt;$USERID&lt;/id&gt;
    &lt;/ns1:SoftLayer_User_CustomerInitParameters&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;ns1:getApiAuthenticationKeys/&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;

=end

</code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20ruby%20-%20create_account_and_api_key.rb&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fruby%2fcreate_account_and_api_key.rb%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
            </p>
    </div>
</div>
        </div>
    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2020<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
