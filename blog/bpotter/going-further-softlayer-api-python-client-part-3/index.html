<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Going Further with the SoftLayer API Python Client - Part 3 - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/blog/bpotter/going-further-softlayer-api-python-client-part-3/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">
    

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
        var head = document.getElementsByTagName('head')[0]
        var style = document.createElement('link')
        style.type = 'text/css'
        style.rel = 'stylesheet'
        style.id = "dark-theme"
        if (localStorage.getItem("dark-mode-theme") == "dark") {
            style.href = '/css/dark.css'
        } else {
            style.href = '/css/light.css'
        }
        head.append(style)
    </script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
            setThemeMode(localStorage.getItem("dark-mode-theme") || "dark");
		})
	</script>
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPZ9ZBSJE"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-9XPZ9ZBSJE');
        }
      </script>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="nav-container">
            <div class="navbar-header" style="width: 150px">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>

            <div class="navbar-header" style="width: calc(100% - 350px)">
                <ul class="nav navbar-nav" style="width: 100%">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Docs</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    
                    <li class="nav-item">
                        <a id="dark-toggle" class="dark-mode-toggle" aria-label="dark-mode-toggle" style="color: var(--Red); font-size: 20px">
                            <i class="fas fa-sun"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <div id="custom-search-input" class="pull-right" style="width: 200px">
              <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                <div class="input-group col-md-12">
                  <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                  <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                  <div class="input-group-btn">
                    <button class="btn btn-info" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>

        </div>
    </nav>

<script type="text/javascript">
const darkIconClass = 'fas fa-moon'
const lightIconClass = 'fas fa-sun'
var darkCSS = $("#dark-theme");
var darkToggleIcon = $("#dark-toggle i");




function setThemeMode(mode) {
    localStorage.setItem("dark-mode-theme", mode);
    if (mode === "dark") {
        darkToggleIcon.attr('class', darkIconClass)
    } else  {
        darkToggleIcon.attr('class', lightIconClass)
    }
}


$("#dark-toggle").click(function () {
  if (darkToggleIcon.attr("class") == lightIconClass) {
    setThemeMode("dark")
  } else if (darkToggleIcon.attr("class") == darkIconClass) {
    setThemeMode("light")
  }
  location.reload();
});
</script>
<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>March 11, 2015<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/blog">blog</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Going Further with the SoftLayer API Python Client - Part 3</h1>
                    <small>In my first two blog posts in this series, &lt;a href=http://sldn.softlayer.com/blog/bpotter/Going-Further-SoftLayer-API-P</small>
                </div>
				
                
				
                <p>In my first two blog posts in this series, <a href="http://sldn.softlayer.com/blog/bpotter/Going-Further-SoftLayer-API-Python-Client-Part-1">Part 1</a> and <a href="http://sldn.softlayer.com/blog/bpotter/Going-Further-SoftLayer-API-Python-Client-Part-2">Part 2</a>, I covered many general aspects of how to use the SoftLayer API effectively. In this post, we&rsquo;ll dive into how to order SoftLayer resources using the SoftLayer API. [For ordering virtual servers, read <a href="http://sldn.softlayer.com/blog/phil/Simplified-CCI-Creation">Simplified CCI Creation</a> for a great explanation of the simplified virtual server ordering process.]</p>
<h2>Understanding How to Order SoftLayer Resources</h2>
  <p>First, it is probably obvious, but to order a resource means to begin renting it, and to cancel a resource means to stop renting it. Some more terminology is necessary: What you actually order is called a product package since a SoftLayer resource is usually made up of many piece parts. Each part of a package is identified by a category, and then you can choose usually one item, in that category. Since each item has a price associated with it, items are usually called item prices. 
</p>
  <p>You need to refer to product packages, categories, and item prices by their id values (integer numbers), so you first have to query the SoftLayer API to figure out what those are. Most of the id values can vary from SoftLayer account to account, so the id number your buddy used is not necessarily the id you should use. Also, the id values can change over time, so you can't query the id values ahead of time and hard-code them in your code. Instead, you have to query, and use the keyNames to get the id values on the fly. I'll show you how to do this.
</p>
<p><strong>Product Packages</strong></p>
  <p>The first thing you need to do is figure out what product package you want to order. The package id values <strong>do</strong> seem to be constant across SoftLayer accounts and don't have a keyName property â€“ I think it is safe to query the package id values once, and hard code the one id you want to use. Here's how to get the list of product packages with id and description: 
</p>
<p><code>import SoftLayer
import pprint</p>
<h1 id="get-the-softlayer-api-client-object">Get the SoftLayer API client object</h1>
<p>client = SoftLayer.Client(username=myuser, api_key=mykey, endpoint_url=SoftLayer.API_PUBLIC_ENDPOINT)</p>
<h1 id="get-the-list-of-packages">Get the list of packages</h1>
<p>pkgs = client[&lsquo;Product_Package&rsquo;].getAllObjects(mask=&lsquo;id, name&rsquo;)
pprint.pprint(pkgs)
</code></p>
<p><strong>Categories and Item Prices</strong></p>
  <p>Now for the package you have selected: Get a list of the categories that can be specified and the item prices within each category that you can choose from. We are going to put the information into a dictionary so you can look at it visually (via pprint) to choose the items you want, and use the dictionary in your code to get the correct id values. 
 </p>
<p><code>import SoftLayer
import pprint</p>
<h1 id="get-the-softlayer-api-client-object-1">Get the SoftLayer API client object</h1>
<p>client = SoftLayer.Client(username=myuser, api_key=mykey, endpoint_url=SoftLayer.API_PUBLIC_ENDPOINT)</p>
<p>def getItems(pkgId):
&lsquo;&lsquo;&lsquo;Get a list of the categories that can be specified and the item prices within each category that you can choose from.&rsquo;&rsquo;&rsquo;
# Build a dict of each category id and what its categoryCode is.  This is only used to build the item dict below.
categories = client[&lsquo;Product_Package&rsquo;].getConfiguration(id=pkgId, mask=&lsquo;isRequired, itemCategory.id, itemCategory.name, itemCategory.categoryCode&rsquo;)
cats = {}
for cat in categories:
catid = cat[&lsquo;itemCategory&rsquo;][&lsquo;id&rsquo;]
cats[catid] = {&lsquo;code&rsquo;:cat[&lsquo;itemCategory&rsquo;][&lsquo;categoryCode&rsquo;], &rsquo;name&rsquo;:cat[&lsquo;itemCategory&rsquo;][&rsquo;name&rsquo;], &lsquo;isRequired&rsquo;:(cat[&lsquo;isRequired&rsquo;] == 1)}</p>
<pre><code># Go thru the items for this pkg and put the key/id pair in the correct category
# Note: the keys are only unique within categories, not between categories
mask = 'id, itemId, recurringFee, hourlyRecurringFee, item.description, item.keyName, categories.id'
itemPrices = client['Product_Package'].getItemPrices(id=pkgId, mask=mask)
items = {}          # this is a 2 level dict: 1st key is categoryCode, 2nd key is item keyName, value is item price id and other info
for itemP in itemPrices:
    if 'categories' not in itemP:  continue
    itemId = itemP['id']
    itemDesc = itemP['item']['description']
    itemKeyName = itemP['item']['keyName']
    if 'recurringFee' in itemP:  itemFee = itemP['recurringFee']
    else:  itemFee = '0'
    if 'hourlyRecurringFee' in itemP:  itemHourlyFee = itemP['hourlyRecurringFee']
    else:  itemHourlyFee = None
    # Go thru this item's supported categories
    for itemCat in itemP['categories']:
        itemCatId = itemCat['id']
        # We correlate the categories and items by the category id
        if itemCatId in cats:
            # This item supports a category in this package, so add it to the structure under this category
            categoryCode = cats[itemCatId]['code']
            # If we haven't yet added an entry for this categoryCode, create it now
            if categoryCode not in items:  items[categoryCode] = {'catName':cats[itemCatId]['name'], 'isRequired':cats[itemCatId]['isRequired'], 'items':{}}
            entry = {'id':itemId, 'description':itemDesc, 'fee':itemFee}
            if itemHourlyFee:  entry['hourlyFee'] = itemHourlyFee
            if itemKeyName in items[categoryCode]['items']:  print 'Warning: items['+categoryCode+&quot;]['items'][&quot;+itemKeyName+'] already has a value of '+str(items[categoryCode]['items'][itemKeyName])+' and we are overwriting it with '+str(entry)
            # Now add the item to this category
            items[categoryCode]['items'][itemKeyName] = entry
return items
</code></pre>
<p>pkgId = 174     # specify the package id you want
items = getItems(pkgId)
pprint.pprint(items)
</code></p>
  <p>In the data structure that is displayed, you will see that the first level key is the category code, and the second level key is the keyName for the item price. For each required category, note the category code, and choose the item price within that category that you want. Then in your code, you can get the id for each item price by specifying the category code key and the item price key. See how this is done in the ordering example below. 
</p>
<p><strong>Ordering a SoftLayer Resource</strong></p>
  <p>As an example for ordering a SoftLayer resource, I'll order a network gateway. The code below assumes you have defined the getItems() function above. 
  </p>
<p><code>import SoftLayer
import pprint</p>
<h1 id="get-the-softlayer-api-client-object-2">Get the SoftLayer API client object</h1>
<p>client = SoftLayer.Client(username=myuser, api_key=mykey, endpoint_url=SoftLayer.API_PUBLIC_ENDPOINT)</p>
<h1 id="the-location-of-the-gateway-is-determined-by-the-first-vlan-to-be-associated-with-it">The location of the gateway is determined by the first VLAN to be associated with it.</h1>
<h1 id="find-the-correct-vlan-id-using-the-vlan-number-and-router-since-there-can-be-duplicate-vlan-numbers">Find the correct VLAN id using the VLAN number and router, since there can be duplicate VLAN numbers</h1>
<p>myVlanNum = 2536   # set it to your vlan number
router = &lsquo;bcr01a.sjc01&rsquo;
vlans = client[&lsquo;Account&rsquo;].getNetworkVlans(mask=&lsquo;id, vlanNumber, primaryRouter.hostname, primaryRouter.datacenter.id&rsquo;,
filter={&rsquo;networkVlans&rsquo;: {&lsquo;vlanNumber&rsquo;: {&lsquo;operation&rsquo;: myVlanNum}, &lsquo;primaryRouter&rsquo;: {&lsquo;hostname&rsquo;: {&lsquo;operation&rsquo;: router} } }})
vlanId = vlans[0][&lsquo;id&rsquo;]
locationId = vlans[0][&lsquo;primaryRouter&rsquo;][&lsquo;datacenter&rsquo;][&lsquo;id&rsquo;]</p>
<p>pkgId = 236
items = getItems(pkgId)      # this function was defined in the previous example</p>
<h1 id="build-the-order-structure">Build the order structure</h1>
<p>productOrder = {
&lsquo;orderContainers&rsquo; : [{
&ldquo;quantity&rdquo; : 1,
&ldquo;hardware&rdquo;: [{
&ldquo;hostname&rdquo;: &lsquo;myhostname&rsquo;,
&ldquo;domain&rdquo;: &lsquo;mydomain.com&rsquo;,
&ldquo;networkVlans&rdquo; : [{&ldquo;id&rdquo; : vlanId}]
}],
&ldquo;location&rdquo;: locationId,
&ldquo;packageId&rdquo;: pkgId,
&ldquo;prices&rdquo;: [
{&lsquo;id&rsquo;: items[&lsquo;server&rsquo;][&lsquo;items&rsquo;][&lsquo;INTEL_XEON_2650_2_00&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;os&rsquo;][&lsquo;items&rsquo;][&lsquo;OS_VYATTA_6_X_SUBSCRIPTION_EDITION_64_BIT&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;ram&rsquo;][&lsquo;items&rsquo;][&lsquo;RAM_16_GB_DDR3_1333_ECC_REG&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;disk_controller&rsquo;][&lsquo;items&rsquo;][&lsquo;DISK_CONTROLLER_RAID&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;disk0&rsquo;][&lsquo;items&rsquo;][&lsquo;HARD_DRIVE_500GB_SATA_II&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;bandwidth&rsquo;][&lsquo;items&rsquo;][&lsquo;BANDWIDTH_20000_GB&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;port_speed&rsquo;][&lsquo;items&rsquo;][&lsquo;1_GBPS_REDUNDANT_PUBLIC_PRIVATE_NETWORK_UPLINKS&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;remote_management&rsquo;][&lsquo;items&rsquo;][&lsquo;REBOOT_KVM_OVER_IP&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;pri_ip_addresses&rsquo;][&lsquo;items&rsquo;][&lsquo;1_IP_ADDRESS&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;power_supply&rsquo;][&lsquo;items&rsquo;][&lsquo;REDUNDANT_POWER_SUPPLY&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;monitoring&rsquo;][&lsquo;items&rsquo;][&lsquo;MONITORING_HOST_PING_AND_TCP_SERVICE&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&rsquo;notification&rsquo;][&lsquo;items&rsquo;][&lsquo;NOTIFICATION_EMAIL_AND_TICKET&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;response&rsquo;][&lsquo;items&rsquo;][&lsquo;AUTOMATED_NOTIFICATION&rsquo;][&lsquo;id&rsquo;]},
{&lsquo;id&rsquo;: items[&lsquo;vpn_management&rsquo;][&lsquo;items&rsquo;][&lsquo;UNLIMITED_SSL_VPN_USERS_1_PPTP_VPN_USER_PER_ACCOUNT&rsquo;][&lsquo;id&rsquo;]},
],
}]
}</p>
<h1 id="right-now-we-are-just-verifying-that-we-built-the-order-correctly">Right now we are just verifying that we built the order correctly.</h1>
<h1 id="uncomment-the-placeorder-call-if-you-really-want-to-order-the-gateway">Uncomment the placeOrder() call if you really want to order the gateway.</h1>
<p>order = client[&lsquo;Product_Order&rsquo;].verifyOrder(productOrder)</p>
<h1 id="order--clientproduct_orderplaceorderproductorder-false">order = client[&lsquo;Product_Order&rsquo;].placeOrder(productOrder, False)</h1>
<h1 id="order-will-be-a-large-structure-that-softlayer-fills-out-representing-the-complete-order-and-pricing">order will be a large structure that SoftLayer fills out, representing the complete order and pricing</h1>
<p>pprint.pprint(order)
</code></p>
<p><strong>Checking the Status of Your Order</strong></p>
  <p>Now that you've ordered a SoftLayer resource, you probably want to find out, via the API, when the resource will be available. One of the properties returned in the order data structure in the ordering example above is the orderId (if you actually ordered the resource and didn't just verify the order). You can use this to check the order status, with this call: 
  </p>
<p><code>status = client[&lsquo;Billing_Order&rsquo;].getObject(id=orderId, mask=&lsquo;status&rsquo;)</code></p>
  <p>But this actually isn't that useful because the order status usually goes to APPROVED pretty
quickly, and I've never seen it go to COMPLETED. Instead, you should query to see if the resource you ordered is actually available; in our case, by looking for the network gateway we ordered:
</p>
<p><code>import SoftLayer
import pprint</p>
<h1 id="get-the-softlayer-api-client-object-3">Get the SoftLayer API client object</h1>
<p>client = SoftLayer.Client(username=myuser, api_key=mykey, endpoint_url=SoftLayer.API_PUBLIC_ENDPOINT)</p>
<p>mygateway = &lsquo;v1&rsquo;
gateways = client[&lsquo;Account&rsquo;].getNetworkGateways(mask=&lsquo;id, name, status.name&rsquo;, filter={&rsquo;networkGateways&rsquo;: {&rsquo;name&rsquo;: {&lsquo;operation&rsquo;: mygateway}}})
if len(gateways) &gt; 0:
pprint.pprint(gateways)
</code></p>
  <p>In the case of network gateways, they have a status value that is "Pending" while it is still being provisioned and "Active" when it is ready. Not all SoftLayer resources have a status value like this. 
  </p>
<p>I hope this series has been informative. If you have any questions, please send an email to <a href="mailto:social@softlayer.com">social@softlayer.com</a>.</p>
<p>-Bruce</p>

            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm footer" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20blog%20-%20Going%20Further%20with%20the%20SoftLayer%20API%20Python%20Client%20-%20Part%203&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fblog%2fbpotter%2fgoing-further-softlayer-api-python-client-part-3%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
                <span> - </span>
                <a class="" href="https://github.com/softlayer/githubio_source/edit/master/content/blog/going-further-softlayer-api-python-client-part-3.md" style="text-align: right;"> Quick Edit</a>
                <i class="fab fa-github" alt="github"></i>

            </p>
    </div>
</div>

        </div>
    </div>
<footer>
    <div class="row">
        <div class="col-sm-12 footer">
            <p>&copy; SoftLayer 2024<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
