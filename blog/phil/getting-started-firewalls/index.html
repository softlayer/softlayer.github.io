<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Getting started with Firewalls - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/blog/phil/getting-started-firewalls/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
   
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPZ9ZBSJE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9XPZ9ZBSJE');
</script>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>June 4, 2013<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/blog">blog</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Getting started with Firewalls</h1>
                    <small>&lt;p&gt;SoftLayer provides two flavors of firewall service that share some API components. Single device firewall solutions a</small>
                </div>
				
                
				
                <p>SoftLayer provides two flavors of firewall service that share some API components. Single device firewall solutions are interacted with through the <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Component_Firewall/">SoftLayer_Network_Component_Firewall</a> service and VLAN firewalls can be accessed with the <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Firewall_AccessControlList/">SoftLayer_Network_Firewall_AccessControlList</a> service.</p>
<h1>Single device firewalls</h1>
<h2>Listing</h2>
<p>As <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall/">SoftLayer_Network_Component_Firewall</a> objects are attached to the device they are providing protection for. The best way to retrieve a list of all firewalls protecting dedicated servers is a call to <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Account/getHardware">SoftLayer_Account::getHardware</a> with an object mask for "firewallServiceComponent". A list of firewalls protecting Cloud Computing Instances can be found with <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Account/getVirtualGuests">SoftLayer_Account::getVirtualGuests</a> using the same object mask.</p>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$client</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Account'</span><span style="color: #339933;">,</span> <span style="color: #000000; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$objectMask</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">"mask.firewallServiceComponent"</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$client</span><span style="color: #339933;">-></span><span style="color: #004000;">setObjectMask</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$objectMask</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$domains</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-></span><span style="color: #004000;">getHardware</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a href="http://www.php.net/print_r"><span style="color: #990000;">print_r</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$domains</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div>
<h2>Rules</h2>
<h3>Listing</h3>
<p>Each <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall/">SoftLayer_Network_Component_Firewall</a> object stores its rules in the "rules" relational property. This property contains an array of <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall_Rule/">SoftLayer_Network_Component_Firewall_Rule</a> objects. These objects define the firewall rule and how it will behave. We can retrieve a list of these rules with <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Component_Firewall/getRules">SoftLayer_Network_Component_Firewall::getRules</a>.</p>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$client</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Network_Component_Firewall'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12345</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$rules</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-></span><span style="color: #004000;">getRules</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a href="http://www.php.net/print_r"><span style="color: #990000;">print_r</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div>
<h3>Modification</h3>
<p>A firewall's ruleset is modified by passing a <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Firewall_Update_Request/">SoftLayer_Network_Firewall_Update_Request</a> template object to <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Firewall_Update_Request/createObject">SoftLayer_Network_Firewall_Update_Request::createObject</a>. The entire ruleset is rewritten with each update request. This means it is necessary to include all past unchanged  rules along with any modifications or additions. This is easily accomplished by pulling in the existing rules as described above then modifying the gathered array.<br />
Each <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall_Update_Request_Rule/">SoftLayer_Network_Component_Firewall_Update_Request_Rule</a> object requires:</p>
<ul>
<li>action - permit or deny</li>
<li>destinationIpAddress - destination address </li>
<li>destinationIpSubnetMask - subnet mask for destination</li>
<li>sourceIpAddress - originating address</li>
<li>sourceIpSubnetMask - subnet mask for origin address</li>
<li>protocol - tcp/udp </li>
<li>destinationPortRangeStart - first port the rule will effect</li>
<li>destinationPortRangeEnd - last port the rule will effect</li>
<li>orderValue - order in which rules are applied (lower is sooner)</li>
</ul>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$firewallId</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">123456</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$firewallClient</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Network_Component_Firewall'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$firewallId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$rules</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$firewallClient</span><span style="color: #339933;">-></span><span style="color: #004000;">getRules</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Adding a rule</span>
<span style="color: #000088;">$newRule</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> stdClass<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">action</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'permit'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationIpAddress</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'172.16.0.1'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationIpSubnetMask</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'255.255.255.255'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationPortRangeStart</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationPortRangeEnd</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">25</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">orderValue</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span>rules<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">protocol</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'tcp'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpAddress</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'192.168.1.1'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpSubnetMask</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'255.255.255.255'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$rules</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$newRule</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Modifying a rule</span>
<span style="color: #000088;">$ipToAllow</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'192.168.1.2'</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=></span> <span style="color: #000088;">$rule</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$rule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpAddress</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$ipToAllow</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000088;">$rules</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">-></span><span style="color: #004000;">action</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'deny'</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Deleting a rule</span>
<span style="color: #000088;">$ipToDelete</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'192.168.1.3'</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=></span> <span style="color: #000088;">$rule</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpAddress</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$ipToDelete</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div>
<p>The update request object requires the following properties:</p>
<ul>
<li>networkComponentFirewallId - identifier of the firewall object</li>
<li>rules - an array of <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall_Update_Request_Rule/">SoftLayer_Network_Component_Firewall_Update_Request_Rule</a> objects</li>
</ul>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$updateRequestClient</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Network_Firewall_Update_Request'</span><span style="color: #339933;">,</span> <span style="color: #000000; font-weight: bold;">Null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$updateRequestTemplate</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> stdClass<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$updateRequestTemplate</span><span style="color: #339933;">-></span><span style="color: #004000;">networkComponentFirewallId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$firewallId</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$updateRequestTemplate</span><span style="color: #339933;">-></span><span style="color: #004000;">rules</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$rules</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$updateRequestClient</span><span style="color: #339933;">-></span><span style="color: #004000;">createObject</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$updateRequestTemplate</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a href="http://www.php.net/print_r"><span style="color: #990000;">print_r</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div>
<p><a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Firewall_Update_Request/createObject">SoftLayer_Network_Firewall_Update_Request::createObject</a> will return a fully populated <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Firewall_Update_Request/">SoftLayer_Network_Firewall_Update_Request</a> object and it will enter the update queue. The request is typically processed within 60 seconds.</p>
<h1>VLAN routed firewalls</h1>
<p>VLAN routed firewalls provide protection to an entire <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Vlan/">SoftLayer_Network_Vlan</a> rather than a specific server. Many of the concepts from single device firewalls translate to VLAN routed firewalls; however, there are some small differences. The interaction point for VLAN routed firewalls is the <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Firewall_AccessControlList/">SoftLayer_Network_Firewall_AccessControlList</a> service.</p>
<p>Each VLAN has two types of firewallInterface: 'inside' and 'outisde'. firewallContextAccessControlLists are organized by a direction of 'in' or 'out'. Currently the SoftLayer Platform supports the 'outside' firewallInterfaces and the 'in' ACLs.</p>
<h2>Listing</h2>
<p>A list of all VLAN routed firewalls can be gathered with a call to <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Account/getNetworkVlans">SoftLayer_Account::getNetworkVlans</a> with an object mask for firewallInterfaces.firewallContextAccessControlLists.</p>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$client</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Account'</span><span style="color: #339933;">,</span> <span style="color: #000000; font-weight: bold;">null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$objectMask</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">"mask.firewallInterfaces.firewallContextAccessControlLists"</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$client</span><span style="color: #339933;">-></span><span style="color: #004000;">setObjectMask</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$objectMask</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$vlans</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-></span><span style="color: #004000;">getNetworkVlans</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlans</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$vlan</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlan</span><span style="color: #339933;">-></span><span style="color: #004000;">firewallInterfaces</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <a href="http://www.php.net/print_r"><span style="color: #990000;">print_r</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$vlan</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div>
<h2>Rules</h2>
<h3>Listing</h3>
<p>Each <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Firewall_AccessControlList/">SoftLayer_Network_Firewall_AccessControlList</a> object stores its rules in the "rules" relational property. This property contains an array of <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall_Rule/">SoftLayer_Network_Component_Firewall_Rule</a> objects. These objects define the firewall rule and how it will behave. We can retrieve a list of these rules with <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Firewall_AccessConrtolList/getRules">SoftLayer_Network_Firewall_AccessConrtolList::getRules</a>.</p>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$vlanFirewalId</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1234</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$client</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Network_Firewall_AccessControlList'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$vlanFirewalId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$rules</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$client</span><span style="color: #339933;">-></span><span style="color: #004000;">getRules</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a href="http://www.php.net/print_r"><span style="color: #990000;">print_r</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div>
<h3>Modification</h3>
<p>A firewall's ruleset is modified by passing a <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Firewall_Update_Request/">SoftLayer_Network_Firewall_Update_Request</a> template object to <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Firewall_Update_Request/createObject">SoftLayer_Network_Firewall_Update_Request::createObject</a>. The entire ruleset is rewritten with each update request. This means it is necessary to include all past unchanged  rules along with any modifications or additions. This is easily accomplished by pulling in the existing rules as described above then modifying the gathered array.<br />
Each <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall_Update_Request_Rule/">SoftLayer_Network_Component_Firewall_Update_Request_Rule</a> object requires:</p>
<ul>
<li>action - permit or deny</li>
<li>destinationIpAddress - destination address</li>
<li>destinationIpSubnetMask - subnet mask for destination</li>
<li>sourceIpAddress - originating address</li>
<li>sourceIpSubnetMask - subnet mask for origin address</li>
<li>protocol - tcp/udp </li>
<li>destinationPortRangeStart - first port the rule will effect</li>
<li>destinationPortRangeEnd - last port the rule will effect</li>
<li>orderValue - order in which rules are applied (lower is sooner)</li>
</ul>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$vlanFirewalId</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">123456</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$firewallClient</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Network_Firewall_AccessControlList'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$vlanFirewalId</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$rules</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$firewallClient</span><span style="color: #339933;">-></span><span style="color: #004000;">getRules</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Adding a rule</span>
<span style="color: #000088;">$newRule</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> stdClass<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">action</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'permit'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationIpAddress</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'172.16.0.1'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationIpSubnetMask</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'255.255.255.255'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationPortRangeStart</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">destinationPortRangeEnd</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">25</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">orderValue</span> <span style="color: #339933;">=</span> <a href="http://www.php.net/count"><span style="color: #990000;">count</span></a><span style="color: #009900;">&#40;</span>rules<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">protocol</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'tcp'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpAddress</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'192.168.1.1'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$newRule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpSubnetMask</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'255.255.255.255'</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$rules</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$newRule</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Modifying a rule</span>
<span style="color: #000088;">$ipToAllow</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'192.168.1.2'</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=></span> <span style="color: #000088;">$rule</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$rule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpAddress</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$ipToAllow</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #000088;">$rules</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">-></span><span style="color: #004000;">action</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'deny'</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Deleting a rule</span>
<span style="color: #000088;">$ipToDelete</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'192.168.1.3'</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span> <span style="color: #b1b100;">as</span> <span style="color: #000088;">$key</span> <span style="color: #339933;">=></span> <span style="color: #000088;">$rule</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rule</span><span style="color: #339933;">-></span><span style="color: #004000;">sourceIpAddress</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$ipToDelete</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <a href="http://www.php.net/unset"><span style="color: #990000;">unset</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$rules</span><span style="color: #009900;">&#91;</span><span style="color: #000088;">$key</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div>
<p>The update request object requires the following properties:</p>
<ul>
<li>firewallContextAccessControlListId - identifier of the VLAN firewall object</li>
<li>rules - an array of <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Firewall_Update_Request_Rule/">SoftLayer_Network_Component_Firewall_Update_Request_Rule</a> objects</li>
</ul>
<div class="geshifilter">
<pre class="php geshifilter-php" style="font-family:monospace;"><span style="color: #000088;">$updateRequestClient</span> <span style="color: #339933;">=</span> SoftLayer_SoapClient<span style="color: #339933;">::</span><span style="color: #004000;">getClient</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'SoftLayer_Network_Firewall_Update_Request'</span><span style="color: #339933;">,</span> <span style="color: #000000; font-weight: bold;">Null</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiUser</span><span style="color: #339933;">,</span> <span style="color: #000088;">$apiKey</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$updateRequestTemplate</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> stdClass<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$updateRequestTemplate</span><span style="color: #339933;">-></span> <span style="color: #004000;">firewallContextAccessControlListId</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$vlanFirewalId</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$updateRequestTemplate</span><span style="color: #339933;">-></span><span style="color: #004000;">rules</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$rules</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$updateRequestClient</span><span style="color: #339933;">-></span><span style="color: #004000;">createObject</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$updateRequestTemplate</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a href="http://www.php.net/print_r"><span style="color: #990000;">print_r</span></a><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div>
<p><a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Firewall_Update_Request/createObject">SoftLayer_Network_Firewall_Update_Request::createObject</a> will return a fully populated <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Firewall_Update_Request/">SoftLayer_Network_Firewall_Update_Request</a> object and it will enter the update queue. The request is typically processed within 60 seconds.</p>

            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20blog%20-%20Getting%20started%20with%20Firewalls&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fblog%2fphil%2fgetting-started-firewalls%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
            </p>
    </div>
</div>
        </div>
    </div>
<footer>
    <div class="row">
        <div class="col-sm-12">
            <p>&copy; SoftLayer 2022<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
