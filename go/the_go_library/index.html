<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Understanding the softlayer-go library - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/go/the_go_library/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPZ9ZBSJE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9XPZ9ZBSJE', { 'anonymize_ip': false });
}
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>May 23, 2022<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/go">go</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/utility">Utility</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/cli">cli</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/article">article</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Understanding the softlayer-go library</h1>
                    <small>An in depth explanation of the softlayer-go library and how to make use of it in your applications.</small>
                </div>
				
                
				
                <h2 id="go-basics" class="anchor-link"><a href="#go-basics">The Basics</a></h2>
<p>The <a href="https://github.com/softlayer/softlayer-go">softlayer-go</a> library helps users make API calls to the SoftLayer (aka IBM Cloud Classic Infrastructure) API.</p>
<p>To get started, here is a simple example.</p>
<p>(We are working in the <code>go/src/github.ibm.com/SoftLayer/sl-test</code> directory for these examples)
This file will be <code>main.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/sl&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/session&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/services&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// softlayer-go/session looks for username and apikey in ~/.softlayer file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// or the SL_USERNAME/SL_API_KEY environment variables.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">sess</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sess</span><span class="p">.</span><span class="nx">Debug</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">objectMask</span> <span class="o">:=</span> <span class="s">&#34;mask[id,hostname,domain]&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Looks for hostname starting with `spectrum`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">filterObject</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="s">`{&#34;hardware&#34;:{&#34;hostname&#34;:{&#34;operation&#34;:&#34;^=spectrum&#34;}}}`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">servers</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">services</span><span class="p">.</span><span class="nf">GetAccountService</span><span class="p">(</span><span class="nx">sess</span><span class="p">).</span><span class="nf">Filter</span><span class="p">(</span><span class="nx">filterObject</span><span class="p">).</span><span class="nf">Mask</span><span class="p">(</span><span class="nx">objectMask</span><span class="p">).</span><span class="nf">GetHardware</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;\n Unable to get server object:\n - %s\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Id, Hostname, Domain\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span><span class="nx">server</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">servers</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// use `sl.Get()` since API results are always memory addresses. This helper function makes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// them a little easier to use
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v, %v, %v\n&#34;</span><span class="p">,</span> <span class="nx">sl</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Id</span><span class="p">),</span> <span class="nx">sl</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Hostname</span><span class="p">),</span> <span class="nx">sl</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Domain</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then we need to download the libraries into the <code>go.mod</code> file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">go mod init
</span></span><span class="line"><span class="cl">go mod tidy
</span></span></code></pre></div><p>Then just build and run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">go build main.go
</span></span><span class="line"><span class="cl">./main
</span></span><span class="line"><span class="cl">Calling services.GetAccountService(sess).Filter(filterObject).Mask(objectMask).GetHardware()
</span></span><span class="line"><span class="cl">2022/05/24 15:24:44 [DEBUG] Request URL:  GET https://api.softlayer.com/rest/v3.1/SoftLayer_Account/getHardware.json?objectFilter=%7B%22hardware%22%3A%7B%22hostname%22%3A%7B%22operation%22%3A%22%5E%3Dspectrum%22%7D%7D%7D&amp;objectMask=mask%5Bid%2Chostname%2Cdomain%5D
</span></span><span class="line"><span class="cl">2022/05/24 15:24:44 [DEBUG] Parameters:
</span></span><span class="line"><span class="cl">2022/05/24 15:24:44 [DEBUG] Status Code:  200
</span></span><span class="line"><span class="cl">2022/05/24 15:24:44 [DEBUG] Response:  [{&#34;domain&#34;:&#34;test.com&#34;,&#34;hostname&#34;:&#34;spectrum-virtualize-par-1&#34;,&#34;id&#34;:3071920}]
</span></span><span class="line"><span class="cl">Id, Hostname, Domain
</span></span><span class="line"><span class="cl">3071920, spectrum-virtualize-par-1, test.com
</span></span></code></pre></div><h2 id="go-breakdown" class="anchor-link"><a href="#go-breakdown">Code Breakdown</a></h2>
<h3 id="package-name">Package Name</h3>
<p>Line 1 is easy enough, just set the package name, main works well if this is just for testing.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="imports">Imports</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/sl&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/session&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/services&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The softlayer-go package has several sub-packages we can make use of.</p>
<ol>
<li><code>github.com/softlayer/softlayer-go/sl</code> Has some helper and error handling functions</li>
<li><code>github.com/softlayer/softlayer-go/session</code> Will always be required, as it sets up the Authentication Session for actually making the API call</li>
<li><code>github.com/softlayer/softlayer-go/services</code> These are autogenerated from the list of available Services in the SoftLayer API. When building an API call, you will first need an instance of the specific service you are working with.</li>
</ol>
<p>Some other imports that are available, but not used here:</p>
<ol start="4">
<li><code>github.com/softlayer/softlayer-go/datatypes</code> Has the datatype definitions, if you need them. Generally these are required if you are sending in data to the SoftLayer API, for example when ordering, or making changes to an object.</li>
<li><code>github.com/softlayer/softlayer-go/filter</code> Has some helper functions for building more complex fiters, although we just use a string in our example</li>
<li><code>github.com/softlayer/softlayer-go/helpers</code> Contains some functions that might be useful when working some of the more complex API calls, like ordering. A good souce of example on how the softlayer-go client makes API calls as well</li>
<li><code>github.com/softlayer/softlayer-go/examples</code> Has some simple examples.</li>
</ol>
<h3 id="main">Main()</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// softlayer-go/session looks for username and apikey in ~/.softlayer file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// or the SL_USERNAME/SL_API_KEY environment variables.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">sess</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sess</span><span class="p">.</span><span class="nx">Debug</span> <span class="p">=</span> <span class="kc">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This sets up our <code>main()</code> function, which is required for any go program. From there it sets up a new <a href="https://github.com/softlayer/softlayer-go#sessions"><code>session</code></a> object. By default it will look in the ~/.softlayer config file, or environment variables for your username and API key so you don&rsquo;t have to put them in the code itself. While <a href="https://sldn.softlayer.com">SLDN</a> has some examples where the username/api key is passed directly to <code>session.New()</code> this is a bit of a bad practice.</p>
<p>From there it sets <code>sess.Debug = true</code> which tells the softlayer-go library to print out all the API calls and results, which can be useful in understanding what exactly is going on under the hood.</p>
<h3 id="the-api-call">The API Call</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">        <span class="nx">objectMask</span> <span class="o">:=</span> <span class="s">&#34;mask[id,hostname,domain]&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Looks for hostname starting with `spectrum`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">filterObject</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="s">`{&#34;hardware&#34;:{&#34;hostname&#34;:{&#34;operation&#34;:&#34;^=spectrum&#34;}}}`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">servers</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">services</span><span class="p">.</span><span class="nf">GetAccountService</span><span class="p">(</span><span class="nx">sess</span><span class="p">).</span><span class="nf">Filter</span><span class="p">(</span><span class="nx">filterObject</span><span class="p">).</span><span class="nf">Mask</span><span class="p">(</span><span class="nx">objectMask</span><span class="p">).</span><span class="nf">GetHardware</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this example we are making an API call to the <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Account/"><code>SoftLayer_Account</code></a> service, which has a <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Account/getHardware/"><code>GetHardware()</code></a> method. In golang any public method or property must start with a capital letter, which is why here the method is <code>GetHardware</code> but in the documentation it is <code>getHardware</code>. The same applies for any property returned, they will all need to start with a capital letter, as we will see as we continue this example.</p>
<p>Because <code>SoftLayer_Account::getHardware()</code> returns a <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Hardware/">SoftLayer_Hardware</a> object, our object mask can include any property listed on the <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Hardware/">SoftLayer_Hardware</a> datatype page. Here we just select the local properties <code>id, hostname, domain</code>. Read more about <a href="https://sldn.softlayer.com/article/object-masks/">Object Masks</a></p>
<p>Next we setup an <a href="https://sldn.softlayer.com/article/object-filters/">Object Filter</a>, which are generally optional. For this example though we just want to get any hardware that have a hostname that starts with the string <code>spectrum</code>. Here we setup a simple string filter, but more complex filters might benefit from using the <a href="https://github.com/softlayer/softlayer-go#filter-builder">Filter Builder</a>. Since this filter is using the <code>Account</code> service, the filter needs to start at the <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Account/">SoftLayer_Account</a> datatype (unlike the object mask).</p>
<p>Lastly, we put all these pieces together to make an API call. Most API calls will return 2 objects, the first being whatever the API method itself is set to return (in this case a map of <code>SoftLayer_Hardware</code> objects), and an error if there was one. Usually this is an either/or situation, you won&rsquo;t ever get an error and data back.</p>
<h3 id="error-handling">Error handling</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;\n Unable to get server object:\n - %s\n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Generally if there is an error, simply printing out a message and the actual error itself is enough.</p>
<h3 id="printing-the-result">Printing the result</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Id, Hostname, Domain\n&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span><span class="nx">server</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">servers</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// use `sl.Get()` since API results are always memory addresses. This helper function makes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// them a little easier to use
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%v, %v, %v\n&#34;</span><span class="p">,</span> <span class="nx">sl</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Id</span><span class="p">),</span> <span class="nx">sl</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Hostname</span><span class="p">),</span> <span class="nx">sl</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Domain</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Printing out data is usually simple enough. The only thing you might need to be aware of is that the results of the API calls are all going to be pointers. In this example we use <code>sl.Get()</code> to resolve those pointers, but the following would work too:</p>
<p><code>fmt.Printf(&quot;%v, %v, %v\n&quot;, *server.Id, *server.Hostname, *server.Domain)</code></p>
<h3 id="updating-services-and-datatypes">Updating Services and Datatypes</h3>
<p>The services and datatypes packages are kept updated monthly (although not usually attached to a new version every month). If for some reason there is an API you want to use, but not included in the latest version, please let us know about it on our <a href="https://github.com/softlayer/softlayer-go/issues">github issues</a> page.</p>
<p>To update those manually however, you will need to run <a href="https://github.com/softlayer/softlayer-go/blob/master/Makefile#L41"><code>make generate</code></a> in the softlayer-go library in your build, and use the <a href="https://go.dev/doc/modules/gomod-ref#replace">replace</a> directive in go.mod to make sure go uses the local softlayer-go when building your app.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd ~/go/src/github.com/softlayer/softlayer-go/
</span></span><span class="line"><span class="cl">git pull origin master
</span></span><span class="line"><span class="cl">make generate
</span></span></code></pre></div><p>If you dont have make installed:
<code>go run tools/main.go tools/loadmeta.go tools/common.go tools/version.go generate</code></p>
<h2 id="iteration">Iteration</h2>
<p>On occasions where the result you want from the API is too large to be done in one request, or takes too long for a single request, iterating (paginating) through the results is always a good idea.</p>
<blockquote>
<p>ALWAYS use an orderBy objectFilter when paginating through results. Otherwise the API might not order the results the same way between queries.</p>
</blockquote>
<p>For these cases, the following is a good pattern to use</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/datatypes&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/filter&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/services&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/session&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;github.com/softlayer/softlayer-go/sl&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ListInstances</span><span class="p">()</span>  <span class="p">([]</span><span class="nx">datatypes</span><span class="p">.</span><span class="nx">Virtual_Guest</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">sess</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">filters</span> <span class="o">:=</span> <span class="nx">filter</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">filters</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">filters</span><span class="p">,</span> <span class="nx">filter</span><span class="p">.</span><span class="nf">Path</span><span class="p">(</span><span class="s">&#34;virtualGuests.id&#34;</span><span class="p">).</span><span class="nf">OrderBy</span><span class="p">(</span><span class="s">&#34;DESC&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nx">accountService</span> <span class="o">:=</span> <span class="nx">services</span><span class="p">.</span><span class="nf">GetAccountService</span><span class="p">(</span><span class="nx">session</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">limit</span> <span class="o">:=</span> <span class="mi">50</span>
</span></span><span class="line"><span class="cl">        <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="nx">resourceList</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">datatypes</span><span class="p">.</span><span class="nx">Virtual_Guest</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Get limit results to start off with
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">vs</span><span class="p">.</span><span class="nx">AccountService</span><span class="p">.</span><span class="nf">Mask</span><span class="p">(</span><span class="nx">mask</span><span class="p">).</span><span class="nf">Filter</span><span class="p">(</span><span class="nx">filters</span><span class="p">.</span><span class="nf">Build</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                                <span class="p">.</span><span class="nf">Limit</span><span class="p">(</span><span class="nx">limit</span><span class="p">).</span><span class="nf">Offset</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">limit</span><span class="p">).</span><span class="nf">GetMonthlyVirtualGuests</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// increment the offset so we get a new page next request
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">i</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// If there was an error, return that and nothing else
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="p">[]</span><span class="nx">datatypes</span><span class="p">.</span><span class="nx">Virtual_Guest</span><span class="p">{},</span> <span class="nx">err</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// append the results to our resourceList
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">resourceList</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">resourceList</span><span class="p">,</span> <span class="nx">resp</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// if we got fewer results than what we asked for, we are done.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">&lt;</span> <span class="nx">limit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">break</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">resourceList</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="error-handling-1">Error Handling</h2>
<p>For any error that occurs within one of the SoftLayer API services, a custom error type is returned, with individual fields that can be parsed separately.</p>
<p>Note that sl.Error implements the standard error interface, so it can be handled like any other error, if the above granularity is not needed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">service</span><span class="p">.</span><span class="nf">Id</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">GetObject</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Error during processing: &#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Note: type assertion is only necessary for inspecting individual fields
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">apiErr</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="nx">sl</span><span class="p">.</span><span class="nx">Error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;API Error:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;HTTP Status Code: %d\n&#34;</span><span class="p">,</span> <span class="nx">apiErr</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;API Code: %s\n&#34;</span><span class="p">,</span> <span class="nx">apiErr</span><span class="p">.</span><span class="nx">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;API Error: %s\n&#34;</span><span class="p">,</span> <span class="nx">apiErr</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="debugging">Debugging</h2>
<p>When running into issues, its always important to know exactly what the softlayer-go client is sending into the API, and getting back in return. For this, simply set <code>session.Debug=True</code>. This will cause softlayer-go to print out API calls it makes, and the JSON data it gets back.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">sess</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">sess</span><span class="p">.</span><span class="nx">Debug</span> <span class="p">=</span> <span class="kc">true</span>
</span></span></code></pre></div><p>Output will look something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">2022/05/26 11:51:51 <span class="o">[</span>DEBUG<span class="o">]</span> Request URL:  GET https://api.softlayer.com/rest/v3.1/SoftLayer_Account/getHardware.json?objectFilter<span class="o">=</span>%7B%22hardware%22%3A%7B%22hostname%22%3A%7B%22operation%22%3A%22%5E%3Dspectrum%22%7D%7D%7D<span class="p">&amp;</span><span class="nv">objectMask</span><span class="o">=</span>mask%5Bid%2Chostname%2Cdomain%5D
</span></span><span class="line"><span class="cl">2022/05/26 11:51:51 <span class="o">[</span>DEBUG<span class="o">]</span> Parameters:
</span></span><span class="line"><span class="cl">2022/05/26 11:51:52 <span class="o">[</span>DEBUG<span class="o">]</span> Status Code:  <span class="m">200</span>
</span></span><span class="line"><span class="cl">2022/05/26 11:51:52 <span class="o">[</span>DEBUG<span class="o">]</span> Response:  <span class="o">[{</span><span class="s2">&#34;domain&#34;</span>:<span class="s2">&#34;test.com&#34;</span>,<span class="s2">&#34;hostname&#34;</span>:<span class="s2">&#34;spectrum-virtualize-par-1&#34;</span>,<span class="s2">&#34;id&#34;</span>:3071920<span class="o">}]</span>
</span></span></code></pre></div><h2 id="ibmcloud-sl-and-other-softlayer-go-examples">ibmcloud sl and other softlayer-go examples</h2>
<p>For a good example of how the softlayer-go library works, the <a href="https://github.com/softlayer/softlayer-cli">ibmcloud sl</a> command is a good place to start.
<a href="https://sldn.softlayer.com/go/">SLDN GO Library</a> also has a nice collection of smaller single use examples that could be useful.</p>
<h2 id="contributing-to-softlayer-go">Contributing to softlayer-go</h2>
<p>If you ever feel the softlayer-go library could be improved please feel free to make a pull request, or even open an <a href="https://github.com/softlayer/softlayer-go/issues">issue</a> on the project&rsquo;s github would be very helpful.</p>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="https://sldn.softlayer.com/article/golang/">Basics of the SoftLayer-Go Library</a></li>
<li><a href="https://sldn.softlayer.com/go/">SoftLayer-Go Examples</a></li>
<li><a href="https://github.com/softlayer/softlayer-go">SoftLayer-Go Github</a></li>
<li><a href="https://github.com/softlayer/softlayer-cli">IBMCLOUD SL Plugin</a></li>
</ul>

            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20go%20-%20Understanding%20the%20softlayer-go%20library&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fgo%2fthe_go_library%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
                <span> - </span>
                <a class="" href="https://github.com/softlayer/githubio_source/edit/master/content/go/go/the_go_library.md.md" style="text-align: right;"> Quick Edit</a>
                <i class="fab fa-github" alt="github"></i>

            </p>
    </div>
</div>

        </div>
    </div>
<footer>
    <div class="row">
        <div class="col-sm-12">
            <p>&copy; SoftLayer 2024<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
