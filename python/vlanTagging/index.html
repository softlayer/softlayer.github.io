<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Trunking VLANs - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/python/vlanTagging/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">
    

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
        var head = document.getElementsByTagName('head')[0]
        var style = document.createElement('link')
        style.type = 'text/css'
        style.rel = 'stylesheet'
        style.id = "dark-theme"
        if (localStorage.getItem("dark-mode-theme") == "dark") {
            style.href = '/css/dark.css'
        } else {
            style.href = '/css/light.css'
        }
        head.append(style)
    </script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
            setThemeMode(localStorage.getItem("dark-mode-theme") || "dark");
		})
	</script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPZ9ZBSJE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9XPZ9ZBSJE', { 'anonymize_ip': false });
}
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="nav-container">
            <div class="navbar-header" style="width: 150px">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>

            <div class="navbar-header" style="width: calc(100% - 350px)">
                <ul class="nav navbar-nav" style="width: 100%">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Docs</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    
                    <li class="nav-item">
                        <a id="dark-toggle" class="dark-mode-toggle" aria-label="dark-mode-toggle" style="color: var(--Red); font-size: 20px">
                            <i class="fas fa-sun"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <div id="custom-search-input" class="pull-right" style="width: 200px">
              <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                <div class="input-group col-md-12">
                  <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                  <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                  <div class="input-group-btn">
                    <button class="btn btn-info" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>

        </div>
    </nav>

<script type="text/javascript">
const darkIconClass = 'fas fa-moon'
const lightIconClass = 'fas fa-sun'
var darkCSS = $("#dark-theme");
var darkToggleIcon = $("#dark-toggle i");




function setThemeMode(mode) {
    localStorage.setItem("dark-mode-theme", mode);
    if (mode === "dark") {
        darkToggleIcon.attr('class', darkIconClass)
    } else  {
        darkToggleIcon.attr('class', lightIconClass)
    }
}


$("#dark-toggle").click(function () {
  if (darkToggleIcon.attr("class") == lightIconClass) {
    setThemeMode("dark")
  } else if (darkToggleIcon.attr("class") == darkIconClass) {
    setThemeMode("light")
  }
  location.reload();
});
</script>
<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>August 4, 2022<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Component">SoftLayer_Network_Component</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/vlan">vlan</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/server">server</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Trunking VLANs</h1>
                    <small>Some examples of how to add VLAN Trunks. AKA VLAN Tagging</small>
                </div>
				
                
				
                <p>This example shows how to add VLAN Trunks to a server.</p>
<p><em>NOTE</em> When trying to get the vlan tags/trunks from a server, the trunk information is on the <code>Hardware_Server-&gt;networkComponent-&gt;uplinkComponent-&gt;networkVlanTrunks</code> relationship.</p>
<h2 id="vlan-trunks">VLAN Trunks</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">@author Christopher Gallo
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Adds specified Public and Private VLANs to a given server ID.
</span></span></span><span class="line"><span class="cl"><span class="s2">Script requried
</span></span></span><span class="line"><span class="cl"><span class="s2">Python 3.7+
</span></span></span><span class="line"><span class="cl"><span class="s2">click 8.0+
</span></span></span><span class="line"><span class="cl"><span class="s2">rich 
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Click is used to make this script support CLI arguments</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">click</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Used for details table output</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rich.console</span> <span class="kn">import</span> <span class="n">Console</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">rich.table</span> <span class="kn">import</span> <span class="n">Table</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">SoftLayer</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">VlanTrunk</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;SoftLayer Client&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">debugger</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">DebugTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transport</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">debugger</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">trunkPublic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serverId</span><span class="p">,</span> <span class="n">vlans</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Adds Trunks to a Public network component&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNetworkComponents</span><span class="p">(</span><span class="n">serverId</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">networkVlans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listToVlan</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">addTrunks</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="n">networkVlans</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&#34;Public&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">trunkPrivate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serverId</span><span class="p">,</span> <span class="n">vlans</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Adds Trunks to a Private network component&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNetworkComponents</span><span class="p">(</span><span class="n">serverId</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">networkVlans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listToVlan</span><span class="p">(</span><span class="n">vlans</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">addTrunks</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="n">networkVlans</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&#34;Private&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">addTrunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_id</span><span class="p">,</span> <span class="n">networkVlans</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&#34;Public&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Makes the actual API call to add VLAN Trunks&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Vlans should be added in a single API call. networkVlans is a list of all the vlans you want added</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;Network_Component&#39;</span><span class="p">,</span> <span class="s1">&#39;addNetworkVlanTrunks&#39;</span><span class="p">,</span> <span class="n">networkVlans</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">component_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;VLANs successfully added&#34;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Unable to trunk vlans on the </span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2"> Interface...&#34;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&#34;red&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s2">&#34;red&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">getNetworkComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serverId</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Returns either Private or Public network component for a server&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;getPrimaryNetworkComponent&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">private</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;getPrimaryBackendNetworkComponent&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">serverId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">component</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">getServerDetails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serverId</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Prints some basic information about the server and its Network Components, VLANs, VLAN Trunks&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">serverMask</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;mask[id,hostname,domain,networkComponents[uplinkComponent[
</span></span></span><span class="line"><span class="cl"><span class="s2">                        networkVlan,networkVlanTrunks[networkVlan[id,vlanNumber]]]]]&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">,</span> <span class="s1">&#39;getObject&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">serverId</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">serverMask</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hostname&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> Network Components&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&#34;Id&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&#34;Primary IP&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&#34;Primary VLAN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&#34;VLAN Trunks&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networkComponents&#39;</span><span class="p">,</span> <span class="p">[]):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;primaryIpAddress&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">uplink</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;uplinkComponent&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">trunks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Trunk information is stored in the UPLINK component, not the server&#39;s component</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">trunk</span> <span class="ow">in</span> <span class="n">uplink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networkVlanTrunks&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">trunk_vlan</span> <span class="o">=</span> <span class="n">trunk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networkVlan&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">trunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">trunk_vlan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vlanNumber&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">vlan</span> <span class="o">=</span> <span class="n">uplink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networkVlan&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Need to cast everything to string for Rich.Table()</span>
</span></span><span class="line"><span class="cl">                <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">str</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">str</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;primaryIpAddress&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">str</span><span class="p">(</span><span class="n">vlan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vlanNumber&#39;</span><span class="p">)),</span> 
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;, &#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trunks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">listToVlan</span><span class="p">(</span><span class="n">vlans</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;converts a list of vlan numbers to SoftLayer_Network_Vlan objects&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">networkVlans</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">vlan</span> <span class="ow">in</span> <span class="n">vlans</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">networkVlans</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;vlanNumber&#39;</span><span class="p">:</span> <span class="n">vlan</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">networkVlans</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@click.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.argument</span><span class="p">(</span><span class="s1">&#39;serverid&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="s1">&#39;--public&#39;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;Public VLAN number to add&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--private&#39;</span><span class="p">,</span> <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;Private VLAN number to add&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--detail&#39;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&#34;Shows details of this server&#39;s network components&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">trunkVlans</span><span class="p">(</span><span class="n">serverid</span><span class="p">,</span> <span class="n">public</span><span class="p">,</span> <span class="n">private</span><span class="p">,</span> <span class="n">detail</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">vlanTrunk</span> <span class="o">=</span> <span class="n">VlanTrunk</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">public</span><span class="p">,</span> <span class="n">private</span><span class="p">,</span> <span class="n">detail</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span><span class="p">(</span><span class="n">click</span><span class="o">.</span><span class="n">ClickException</span><span class="p">(</span><span class="s2">&#34;Specify at least one VLAN, or --detail&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">public</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">vlanTrunk</span><span class="o">.</span><span class="n">trunkPublic</span><span class="p">(</span><span class="n">serverid</span><span class="p">,</span> <span class="n">public</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">private</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">vlanTrunk</span><span class="o">.</span><span class="n">trunkPrivate</span><span class="p">(</span><span class="n">serverid</span><span class="p">,</span> <span class="n">private</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">vlanTrunk</span><span class="o">.</span><span class="n">getServerDetails</span><span class="p">(</span><span class="n">serverid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">trunkVlans</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="output">Output</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ python vlanTaggingExample.py 1403539 --detail --public 997  --private 1325
</span></span><span class="line"><span class="cl">Calling: SoftLayer_Hardware_Server::getPrimaryNetworkComponent(id=1403539, mask=&#39;&#39;, filter=&#39;None&#39;, args=(), limit=None, offset=None))
</span></span><span class="line"><span class="cl">Calling: SoftLayer_Network_Component::addNetworkVlanTrunks(id=10646647, mask=&#39;&#39;, filter=&#39;None&#39;, args=([{&#39;vlanNumber&#39;: &#39;997&#39;}],), limit=None, offset=None))
</span></span><span class="line"><span class="cl">VLANs successfully added
</span></span><span class="line"><span class="cl">Calling: SoftLayer_Hardware_Server::getPrimaryBackendNetworkComponent(id=1403539, mask=&#39;&#39;, filter=&#39;None&#39;, args=(), limit=None, offset=None))
</span></span><span class="line"><span class="cl">Calling: SoftLayer_Network_Component::addNetworkVlanTrunks(id=10646645, mask=&#39;&#39;, filter=&#39;None&#39;, args=([{&#39;vlanNumber&#39;: &#39;1325&#39;}],), limit=None, offset=None))
</span></span><span class="line"><span class="cl">VLANs successfully added
</span></span><span class="line"><span class="cl">Calling: SoftLayer_Hardware_Server::getObject(id=1403539, mask=&#39;mask[id,hostname,domain,networkComponents[uplinkComponent[ networkVlan,networkVlanTrunks[networkVlan[id,vlanNumber]]]]]&#39;, filter=&#39;None&#39;, args=(), limit=None, offset=None))
</span></span><span class="line"><span class="cl">        bardcabero.testedit.com Network Components
</span></span><span class="line"><span class="cl">+--------------------------------------------------------+
</span></span><span class="line"><span class="cl">| Id       | Primary IP     | Primary VLAN | VLAN Trunks |
</span></span><span class="line"><span class="cl">|----------+----------------+--------------+-------------|
</span></span><span class="line"><span class="cl">| 10646645 | 10.93.138.202  | 886          | 1325        |
</span></span><span class="line"><span class="cl">| 10646647 | 169.48.191.244 | 1236         | 997         |
</span></span><span class="line"><span class="cl">+--------------------------------------------------------+
</span></span></code></pre></div><h2 id="old-example">Old Example</h2>
<p>This example was created in 2017 and is kept to show the difference in how the API has changed. In this example, Vlan Trunks are added to the network component in a series of API calls. However it is best to add all VLANs you want in a single API call.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">@author Christopher Gallo
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">@sldn</span><span class="si">{SoftLayer_Network_Component}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">@sldn{SoftLayer_Network_Component,getNetworkVlanTrunks}
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">@manager</span><span class="si">{hardware}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Goes through a list of servers, add the specified vlan to each one
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">SoftLayer</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">testVlanTag</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;SoftLayer Client&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">mgr</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">HardwareManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">addVlanTrunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">vlans</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">            Adds a vlan to a network component
</span></span></span><span class="line"><span class="cl"><span class="s2">            @param id ID of SoftLayer_Network_Component you want to add vlan to
</span></span></span><span class="line"><span class="cl"><span class="s2">            @param vlans dictionary of vlan nubmers you want to add
</span></span></span><span class="line"><span class="cl"><span class="s2">            @sldn{SoftLayer_Network_Component,addNetworkVlanTrunks}
</span></span></span><span class="line"><span class="cl"><span class="s2">            @sldn{SoftLayer_Network_Component,getNetworkVlanTrunks}
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">vlanNumber</span> <span class="ow">in</span> <span class="n">vlans</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;Adding vlan </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vlanNumber</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;Network_Component&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addNetworkVlanTrunks</span><span class="p">([{</span><span class="s1">&#39;vlanNumber&#39;</span><span class="p">:</span><span class="n">vlanNumber</span><span class="p">}],</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">vlan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;Network_Component&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getNetworkVlanTrunks</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">            Runs through a list of server ids and tags them with the proper vlan
</span></span></span><span class="line"><span class="cl"><span class="s2">            Does both public and private interfaces
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;comma seperated list of ids&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">serverIds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14274503</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;comma seperated list of public vlan nubmers to tag on each server&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">publicVlanNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1125</span><span class="p">,</span><span class="mi">1110</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;comma seperated list of private vlan nubmers to tag on each server&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">privateVlanNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1110</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">serverIds</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">hardware</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mgr</span><span class="o">.</span><span class="n">get_hardware</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">privateIP</span> <span class="o">=</span> <span class="n">hardware</span><span class="p">[</span><span class="s1">&#39;primaryBackendIpAddress&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;Private IP is: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">privateIP</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">            <span class="n">publicIP</span> <span class="o">=</span> <span class="n">hardware</span><span class="p">[</span><span class="s1">&#39;primaryIpAddress&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;Public IP is: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">publicIP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">hardware</span><span class="p">[</span><span class="s1">&#39;networkComponents&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;primaryIpAddress&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">publicIP</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">                        <span class="c1"># self.addVlanTrunks(component[&#39;id&#39;],publicVlanNumbers)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">elif</span> <span class="p">(</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;primaryIpAddress&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">privateIP</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">addVlanTrunks</span><span class="p">(</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">privateVlanNumbers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># result = self.client[&#39;Network_Component&#39;].clearNetworkVlanTrunks(id=component[&#39;id&#39;])</span>
</span></span><span class="line"><span class="cl">                    <span class="n">mask</span> <span class="o">=</span> <span class="s1">&#39;networkVlan, networkVlanTrunks, uplinkComponent[networkVlanTrunks]&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">nic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;Network_Component&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">pp</span><span class="p">(</span><span class="n">nic</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;Done with </span><span class="si">%s</span><span class="s2"> &#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hardware</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;=====================================&#34;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span> <span class="o">=</span> <span class="n">testVlanTag</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm footer" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20python%20-%20Trunking%20VLANs&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fpython%2fvlanTagging%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
                <span> - </span>
                <a class="" href="https://github.com/softlayer/githubio_source/edit/master/content/python/python/vlanTagging.md" style="text-align: right;"> Quick Edit</a>
                <i class="fab fa-github" alt="github"></i>

            </p>
    </div>
</div>

        </div>
    </div>
<footer>
    <div class="row">
        <div class="col-sm-12 footer">
            <p>&copy; SoftLayer 2024<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
