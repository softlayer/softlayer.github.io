<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Monitoring Agent Management - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/python/softlayer_monitoring/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-88235803-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>November 23, 2017<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent">SoftLayer_Monitoring_Agent</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent_Configuration_Template_Group">SoftLayer_Monitoring_Agent_Configuration_Template_Group</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Configuration_Template">SoftLayer_Configuration_Template</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest">SoftLayer_Virtual_Guest</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_User_Customer">SoftLayer_User_Customer</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent_Configuration_Value">SoftLayer_Monitoring_Agent_Configuration_Value</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server">SoftLayer_Hardware_Server</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Container_Metric_Data_Type">SoftLayer_Container_Metric_Data_Type</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/monitoring">monitoring</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Monitoring Agent Management</h1>
                    <small>A collection of examples on how to interact with the Monitoring Agent</small>
                </div>
				
                
				
                <p>ResponseStatus codes and what they mean.</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Monitor_Version1_Query_Result">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Monitor_Version1_Query_Result</a></li>
</ul>
<ul>
<li>0: CRITICAL</li>
<li>1: Warning</li>
<li>2: OK</li>
<li>4 - 5: Unknown Status, Contact Support</li>
</ul>
<h3 id="ordering-monitoring">Ordering Monitoring</h3>
<p>Build a SoftLayer_Container_Product_Order_Monitoring_Package object for a new
monitoring order and pass it to the SoftLayer_Product_Order API service to order it
In this care we&rsquo;ll order a Basic (Hardware and OS) package with Basic Monitoring Package - Linux configuration.</p>
<p>Important manual pages:</p>
<ul>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Monitoring_Package">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Monitoring_Package</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Product_Order/verifyOrder">http://sldn.softlayer.com/reference/services/SoftLayer_Product_Order/verifyOrder</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Template_Group">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Template_Group</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Order a Monitoring Package
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">Build a skeleton SoftLayer_Container_Product_Order_Monitoring_Package object
</span><span class="s2">containing the order you wish to place.
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">oderTemplate</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;complexType&#39;</span><span class="p">:</span> <span class="s1">&#39;SoftLayer_Container_Product_Order_Monitoring_Package&#39;</span><span class="p">,</span>
    <span class="s1">&#39;packageId&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># the packageID for order monitoring packages is 0</span>
    <span class="s1">&#39;prices&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">2302</span><span class="p">}</span>  <span class="c1"># this is the price for Monitoring Package - Basic ((Hardware and OS))</span>
    <span class="p">],</span>
    <span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># the quantity for order a service (in this case monitoring package) must be 0</span>
    <span class="s1">&#39;sendQuoteEmailFlag&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;useHourlyPricing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;virtualGuests&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">4906034</span><span class="p">}</span>  <span class="c1"># the virtual guest ID where you want add the monitoring package</span>
    <span class="p">],</span>
    <span class="s1">&#39;configurationTemplateGroups&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>  <span class="c1"># the templateID for the monitoring group (in this case Basic Monitoring package for Unix/Linux operating system.)</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Declare the API client to use the SoftLayer_Product_Order API service</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">productOrderService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Product_Order&#39;</span><span class="p">]</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">verifyOrder() will check your order for errors. Replace this with a call to
</span><span class="s2">placeOrder() when you&#39;re ready to order. Both calls return a receipt object
</span><span class="s2">that you can use for your records.
</span><span class="s2">
</span><span class="s2">Once your order is placed it&#39;ll go through SoftLayer&#39;s provisioning process.
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="n">order</span> <span class="o">=</span> <span class="n">productOrderService</span><span class="o">.</span><span class="n">verifyOrder</span><span class="p">(</span><span class="n">oderTemplate</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

</code></pre></div><h3 id="activate-monitoring-agent">Activate Monitoring Agent</h3>
<p>Important manual pages:</p>
<ul>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">https://softlayer.github.io/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent/activate">https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent/activate</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Active an agent.
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">vsiIp</span> <span class="o">=</span> <span class="s2">&#34;169.45.98.148&#34;</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s2">&#34;DHCP Response Monitoring Agent&#34;</span>


<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">agentService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>


<span class="n">objectMask</span> <span class="o">=</span> <span class="s2">&#34;mask[monitoringRobot[id, robotStatus[name]], monitoringAgents[statusName, name, id], monitoringServiceEligibilityFlag, datacenter]&#34;</span>
<span class="n">vsi</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">vsiIp</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">vsi</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is not a vsi with the IP address: &#34;</span> <span class="o">+</span> <span class="n">vsiIp</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">agents</span> <span class="ow">in</span> <span class="n">vsi</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">agents</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">agentName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span>
        <span class="k">break</span>
<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The VSI does not have a monitor agent with the name: &#34;</span> <span class="o">+</span>  <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agentService</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

</code></pre></div><h3 id="addremove-monitoring-subscriber">Add/Remove Monitoring Subscriber</h3>
<p>The scripts adds subscribers to an arbitrary VSI machine.</p>
<p>Important manual pages:</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/getMonitoringAgents">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/getMonitoringAgents</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getEligibleAlarmSubscibers">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getEligibleAlarmSubscibers</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/setActiveAlarmSubscriber">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/setActiveAlarmSubscriber</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Add subscribers to a monitor
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>

<span class="n">hostnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;rctest&#34;</span><span class="p">,</span> <span class="s2">&#34;rctest2&#34;</span><span class="p">]</span>
<span class="n">mailsToAdd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;someone@test.com&#34;</span><span class="p">,</span> <span class="s2">&#34;someone.else@test.com&#34;</span><span class="p">]</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="c1"># Getting all virtual servers on the account</span>
<span class="n">vServers</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getVirtualGuests</span><span class="p">()</span>
<span class="k">for</span> <span class="n">hostname</span> <span class="ow">in</span> <span class="n">hostnames</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">vServer</span> <span class="ow">in</span> <span class="n">vServers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hostname</span> <span class="o">==</span> <span class="n">vServer</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">]:</span>
            <span class="n">vSertverId</span> <span class="o">=</span> <span class="n">vServer</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="c1"># Getting all the agents in the virtual machine</span>
            <span class="n">agents</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Virtual_Guest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getMonitoringAgents</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">vSertverId</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">agents</span><span class="p">:</span>
                <span class="n">agentId</span> <span class="o">=</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">agentName</span> <span class="o">=</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">elegibleSubscribers</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getEligibleAlarmSubscibers</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">agentId</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">mailToAdd</span> <span class="ow">in</span> <span class="n">mailsToAdd</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">elegibleSubscriber</span> <span class="ow">in</span> <span class="n">elegibleSubscribers</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">elegibleSubscriber</span><span class="p">:</span>
                            <span class="n">suscriberId</span> <span class="o">=</span> <span class="n">elegibleSubscriber</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                            <span class="n">userData</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">suscriberId</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">mailToAdd</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">userData</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                                <span class="n">added</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setActiveAlarmSubscriber</span><span class="p">(</span><span class="n">suscriberId</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">agentId</span><span class="p">)</span>
                                <span class="c1"># Use this to Remove </span>
                                <span class="c1"># removed = client[&#39;SoftLayer_Monitoring_Agent&#39;].removeActiveAlarmSubscriber(suscriberId, id=agentId)</span>
                                <span class="k">if</span> <span class="n">added</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;For hostname: &#34;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="s2">&#34; with ID &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vSertverId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34; in the agent for &#34;</span> <span class="o">+</span> <span class="n">agentName</span> <span class="o">+</span> <span class="s2">&#34; the mail &#34;</span> <span class="o">+</span> <span class="n">mailToAdd</span> <span class="o">+</span> <span class="s2">&#34; has been added.&#34;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ERROR - For hostname: &#34;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="s2">&#34; with ID &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vSertverId</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34; in the agent for &#34;</span> <span class="o">+</span> <span class="n">agentName</span> <span class="o">+</span> <span class="s2">&#34; the mail &#34;</span> <span class="o">+</span> <span class="n">mailToAdd</span> <span class="o">+</span> <span class="s2">&#34; has not been added.&#34;</span><span class="p">)</span>



</code></pre></div><h3 id="clone-monitoring-configuration">Clone monitoring configuration</h3>
<p>The script clones an existing configuration template, performs a change in the
configuration template, then creates a template group and adds the created
configuration template to the new template group.</p>
<p>Important manual pages:</p>
<ul>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Configuration_Template">https://softlayer.github.io/reference/services/SoftLayer_Configuration_Template</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent_Configuration_Template_Group">https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent_Configuration_Template_Group</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Product_Package">https://softlayer.github.io/reference/services/SoftLayer_Product_Package</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Create a monitoring configuration template and a template group
</span><span class="s2">
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>


<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">configurationTemplateService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Configuration_Template&#39;</span><span class="p">]</span>
<span class="n">monitoringAgentConfigurationTemplateGroupService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent_Configuration_Template_Group&#39;</span><span class="p">]</span>
<span class="n">productPackageService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Product_Package&#39;</span><span class="p">]</span>

<span class="n">templates</span> <span class="o">=</span> <span class="n">configurationTemplateService</span><span class="o">.</span><span class="n">getAllObjects</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">newTemplateId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CDM Monitoring agent-MH-Linux v2&#39;</span><span class="p">:</span>
        <span class="c1"># Creating an Skeleton SoftLayer_Configuration_Template for our new template</span>
        <span class="n">templateObject</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;this is my clone test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;clone for test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;parentId&#39;</span><span class="p">:</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="n">newTemplate</span> <span class="o">=</span> <span class="n">configurationTemplateService</span><span class="o">.</span><span class="n">copyTemplate</span><span class="p">(</span><span class="n">templateObject</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">template</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="c1"># Getting the definitions from the parent template to set in the new template e.g. CPU, Memory</span>
        <span class="n">objectMask</span> <span class="o">=</span> <span class="s1">&#39;mask[configurationSections[subSections[definitions]]]&#39;</span>
        <span class="n">definitions</span> <span class="o">=</span> <span class="n">configurationTemplateService</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">template</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

        <span class="c1"># The configuration values for our new template</span>
        <span class="n">configurationValues</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        We are going to define the configuration for our template by default it has the
</span><span class="s2">        same configuration as the parent template.
</span><span class="s2">        we are looking a determinate configuration section in this case CPU section.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">for</span> <span class="n">definition</span> <span class="ow">in</span> <span class="n">definitions</span><span class="p">[</span><span class="s1">&#39;configurationSections&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CPU&#39;</span><span class="p">:</span>
                <span class="c1"># We are looking for the subsection Graphing.</span>
                <span class="k">for</span> <span class="n">subsection</span> <span class="ow">in</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;subSections&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">subsection</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Graphing&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">subdefinition</span> <span class="ow">in</span> <span class="n">subsection</span><span class="p">[</span><span class="s1">&#39;definitions&#39;</span><span class="p">]:</span>
                            <span class="c1"># We are looking the &#39;Graph Total CPU Usage&#39; configuration option.</span>
                            <span class="k">if</span> <span class="n">subdefinition</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Graph Total CPU Usage&#39;</span><span class="p">:</span>
                                <span class="c1"># Setting the configuration for our template</span>
                                <span class="n">configurationValues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&#34;definitionId&#34;</span><span class="p">:</span> <span class="n">subdefinition</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s2">&#34;templateId&#34;</span><span class="p">:</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s2">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">})</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">configurationValues</span><span class="p">)</span>
        <span class="c1"># Updating the new configuration in our created template</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">configurationTemplateService</span><span class="o">.</span><span class="n">updateDefaultValues</span><span class="p">(</span><span class="n">configurationValues</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">newTemplate</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">newTemplateId</span> <span class="o">=</span> <span class="n">newTemplate</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="s2">&#34;&#34;&#34;
</span><span class="s2">Looking for a monitoring package in order to add our new template group
</span><span class="s2">in that monitoring package. In this case we are going to add it to
</span><span class="s2">&#34;Monitoring Package - Basic&#34;
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">monitoringBasicId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">itemsPackage</span> <span class="o">=</span> <span class="n">productPackageService</span><span class="o">.</span><span class="n">getItems</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itemsPackage</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;Monitoring Package - Basic&#34;</span><span class="p">:</span>
        <span class="n">monitoringBasicId</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="k">break</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">To create a template group in &#34;Monitoring package - Basic&#34;
</span><span class="s2">is necessary to specific a configuration template for
</span><span class="s2">Cpu, Disk, and Memory Monitoring Agent
</span><span class="s2">Process Monitoring Agent
</span><span class="s2">Windows Services Monitoring Agent
</span><span class="s2">Remote System Monitoring Agent
</span><span class="s2">we are going to look for the IDs for those configuration templates
</span><span class="s2">except for &#34;Cpu, Disk, and Memory Monitoring Agent&#34;, for this we are going
</span><span class="s2">to use the template that we created above
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">templates</span> <span class="o">=</span> <span class="n">configurationTemplateService</span><span class="o">.</span><span class="n">getAllObjects</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cpuDiskMemoryMonitoringAgent</span> <span class="o">=</span> <span class="n">newTemplateId</span>
<span class="n">processMonitoringAgent</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">windowsServiceMonitoringAgent</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">remoteMonitoringAgent</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;Process Monitoring Agent &#34;</span><span class="p">:</span>
        <span class="n">proccesMonitoringAgent</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;Windows Services Monitoring Agent&#34;</span><span class="p">:</span>
        <span class="n">windowsServiceMonitoringAgent</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;Remote system monitoring agent - Linux V1&#34;</span><span class="p">:</span>
        <span class="n">remoteMonitoringAgent</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">Creating an skeleton SoftLayer_Monitoring_Agent_Configuration_Template_Group for our
</span><span class="s2">new template group
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">templateObject</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;this is my template group test&#34;</span><span class="p">,</span>
    <span class="s2">&#34;itemId&#34;</span><span class="p">:</span> <span class="n">monitoringBasicId</span><span class="p">,</span>
    <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;my template group test&#34;</span><span class="p">,</span>
    <span class="s2">&#34;configurationTemplateReferences&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&#34;configurationTemplateId&#34;</span><span class="p">:</span> <span class="n">newTemplateId</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&#34;configurationTemplateId&#34;</span><span class="p">:</span> <span class="n">processMonitoringAgent</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&#34;configurationTemplateId&#34;</span><span class="p">:</span> <span class="n">windowsServiceMonitoringAgent</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&#34;configurationTemplateId&#34;</span><span class="p">:</span> <span class="n">remoteMonitoringAgent</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">monitoringAgentConfigurationTemplateGroupService</span><span class="o">.</span><span class="n">createObject</span><span class="p">(</span><span class="n">templateObject</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to create the object template for the monitoring agent. &#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div><h3 id="configure-monitoring-agent">Configure Monitoring Agent</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Configure the section &#39;CPU&#39; from the &#39;Cpu, Disk, and Memory Monitoring Agent&#39; agent.
</span><span class="s2">
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># The IP address of the server or VSI to configure.</span>
<span class="n">ipAddres</span> <span class="o">=</span> <span class="s2">&#34;23.246.195.66&#34;</span>

<span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Graph System CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;False&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph Total CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;False&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph User CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;True&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph I/O Wait CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;True&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Processor Queue Length Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;True&#34;</span><span class="p">,</span>
    <span class="s1">&#39;CPU Usage Error Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;True&#34;</span><span class="p">,</span>
    <span class="s1">&#39;CPU Usage Error Alarm Threshold&#39;</span><span class="p">:</span> <span class="s2">&#34;99&#34;</span><span class="p">,</span>
    <span class="s1">&#39;CPU Usage Warning Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;True&#34;</span><span class="p">,</span>
    <span class="s1">&#39;CPU Usage Warning Alarm Threshold&#39;</span><span class="p">:</span> <span class="s2">&#34;82&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Processor Queue Length Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;True&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Max Queue Length&#39;</span><span class="p">:</span> <span class="s2">&#34;4&#34;</span>
<span class="p">}</span>

<span class="c1"># The agent&#39;s name we wish to configure.</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s1">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>
<span class="n">monitoringService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>

<span class="c1"># Getting the monitoring agents installed in the server or VSI.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">objectMask</span> <span class="o">=</span> <span class="s1">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span class="o">+</span> <span class="n">ipAddres</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to get the server: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Getting the agent to configure.</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">agentName</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to find the agent: &#34;</span> <span class="o">+</span> <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Creating an SoftLayer_Monitoring_Agent_Configuration_Value skeleton</span>
<span class="c1"># which contains the configuration for the agent.</span>
<span class="n">configurationValues</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationValues&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">configurationValue</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">configurationValue</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">configurationValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configurationValue</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">itemFound</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The configuration: &#34;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&#34; is not available for the agent.&#34;</span><span class="p">)</span>


<span class="c1"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span class="c1"># to apply the changes in the agent.</span>
<span class="c1"># Note: In case there is no changes in the agent configuration the method</span>
<span class="c1"># will return error.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">monitoringService</span><span class="o">.</span><span class="n">applyConfigurationValues</span><span class="p">(</span><span class="n">configurationValues</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div><h3 id="configure-new-agent-disk-profile">Configure new agent disk profile</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Create a new &#39;Disk Profile&#39; configuration for the &#39;Cpu, Disk, and Memory Monitoring Agent&#39; agent.
</span><span class="s2">
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># The IP address of the server or VSI to configure.</span>
<span class="n">ipAddres</span> <span class="o">=</span> <span class="s2">&#34;23.246.195.66&#34;</span>

<span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Disk Path&#39;</span><span class="p">:</span> <span class="s2">&#34;c:/&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Description&#39;</span><span class="p">:</span> <span class="s2">&#34;file system c:/&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph Disk Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph Disk Usage as Percentage&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Disk Usage Error Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Usage Error Alarm Threshold&#39;</span><span class="p">:</span> <span class="s2">&#34;90&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Disk Usage Warning Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Disk Usage Warning Threshold&#39;</span><span class="p">:</span> <span class="s2">&#34;90&#34;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># The agent&#39;s name we wish to configure.</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s1">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>
<span class="c1"># The agent&#39;s section we wish to change</span>
<span class="n">sectionName</span> <span class="o">=</span> <span class="s2">&#34;Disk Profile&#34;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>
<span class="n">monitoringService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>

<span class="c1"># Getting the monitoring agents installed in the server or VSI.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">objectMask</span> <span class="o">=</span> <span class="s1">&#39;mask[monitoringAgents[configurationTemplate[configurationSections[subSections[definitions]]]]]&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span class="o">+</span> <span class="n">ipAddres</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to get the server: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Getting the agent to configure.</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">agentName</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to find the agent: &#34;</span> <span class="o">+</span> <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Getting the section to configure</span>
<span class="n">sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">section</span> <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationTemplate&#39;</span><span class="p">][</span><span class="s1">&#39;configurationSections&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">section</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sectionName</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to find the section: &#34;</span> <span class="o">+</span> <span class="n">sectionName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">section</span> <span class="o">=</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="c1"># Creating the configuration for the agent.</span>
<span class="n">configurationValues</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">itemConfigured</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">subsection</span> <span class="ow">in</span> <span class="n">section</span><span class="p">[</span><span class="s1">&#39;subSections&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">definition</span> <span class="ow">in</span> <span class="n">subsection</span><span class="p">[</span><span class="s1">&#39;definitions&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">configurationValue</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">itemConfigured</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">configurationValue</span><span class="p">[</span><span class="s1">&#39;configurationDefinitionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">definition</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">configurationValue</span><span class="p">[</span><span class="s1">&#39;agentId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="n">configurationValue</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="n">configurationValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configurationValue</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">itemConfigured</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">itemConfigured</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&#34;Unable to configure: &#34;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&#34; the configuration name was not found.&#34;</span><span class="p">)</span>

<span class="c1"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span class="c1"># to apply the changes in the agent.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">monitoringService</span><span class="o">.</span><span class="n">addConfigurationProfile</span><span class="p">(</span><span class="n">configurationValues</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div><h3 id="configure-agent-memory-profile">Configure Agent Memory Profile</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Configure the section &#39;Memory&#39; from the &#39;Cpu, Disk, and Memory Monitoring Agent&#39; agent.
</span><span class="s2">
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># The IP address of the server or VSI to configure.</span>
<span class="n">ipAddres</span> <span class="o">=</span> <span class="s2">&#34;5.153.59.197&#34;</span>

<span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;Graph Memory Usage&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Graph Memory Usage as Percentage&#34;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Graph Physical Memory Usage&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Graph Physical Memory Usage as Percentage&#34;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Graph Swap Memory Usage&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Graph Swap Memory Usage as Percentage&#34;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Graph System Paging in Kb/s&#34;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Graph System Paging in Pg/s&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Total Memory Usage Error Alarm&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Total Memory Usage Error Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;90&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Total Memory Usage Warning Alarm&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Total Memory Usage Warning Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;50&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Physical Memory Usage Error Alarm&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Physical Memory Usage Error Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;95&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Physical Memory Usage Warning Alarm&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Physical Memory Usage Warning Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;85&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Swap Memory Usage Error Alarm&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Swap Memory Usage Error Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;85&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Swap Memory Usage Warning Alarm&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Swap Memory Usage Warning Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;60&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Paging Error Alarm Active&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Paging Error Alarm Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;400&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Paging Warning Alarm Active&#34;</span><span class="p">:</span> <span class="s2">&#34;FALSE&#34;</span><span class="p">,</span>
    <span class="s2">&#34;Paging Warning Alarm Threshold&#34;</span><span class="p">:</span> <span class="s2">&#34;150&#34;</span>
<span class="p">}</span>

<span class="c1"># The agent&#39;s name we wish to configure.</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s1">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>
<span class="n">monitoringService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>

<span class="c1"># Getting the monitoring agents installed in the server or VSI.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">objectMask</span> <span class="o">=</span> <span class="s1">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span class="o">+</span> <span class="n">ipAddres</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to get the server: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Getting the agent to configure.</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">agentName</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to find the agent: &#34;</span> <span class="o">+</span> <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Creating an SoftLayer_Monitoring_Agent_Configuration_Value skeleton</span>
<span class="c1"># which contains the configuration for the agent.</span>
<span class="n">configurationValues</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationValues&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">configurationValue</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">configurationValue</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">configurationValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configurationValue</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">itemFound</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The configuration: &#34;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&#34; is not available for the agent.&#34;</span><span class="p">)</span>


<span class="c1"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span class="c1"># to apply the changes in the agent.</span>
<span class="c1"># Note: In case there is no changes in the agent configuration the method</span>
<span class="c1"># will return error.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">monitoringService</span><span class="o">.</span><span class="n">applyConfigurationValues</span><span class="p">(</span><span class="n">configurationValues</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div><h3 id="edit-agent-profile">Edit Agent Profile</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Edit the configuration for the &#34;Disk Profile&#34; section
</span><span class="s2">of a monitoring agent.
</span><span class="s2">
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># The IP address of the server or VSI to configure.</span>
<span class="n">ipAddres</span> <span class="o">=</span> <span class="s2">&#34;5.153.59.197&#34;</span>

<span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Disk Path&#39;</span><span class="p">:</span> <span class="s2">&#34;c:/&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Description&#39;</span><span class="p">:</span> <span class="s2">&#34;file system c:/&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph Disk Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph Disk Usage as Percentage&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Disk Usage Error Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Usage Error Alarm Threshold&#39;</span><span class="p">:</span> <span class="s2">&#34;95&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Disk Usage Warning Alarm&#39;</span><span class="p">:</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Disk Usage Warning Threshold&#39;</span><span class="p">:</span> <span class="s2">&#34;90&#34;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># The agent&#39;s name we will configure.</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s1">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>
<span class="n">monitoringService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>

<span class="c1"># Getting the monitoring agents installed in the server or VSI.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">objectMask</span> <span class="o">=</span> <span class="s1">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span class="o">+</span> <span class="n">ipAddres</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to get the server: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Getting the agent to configure.</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">agentName</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to find the agent: &#34;</span> <span class="o">+</span> <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Getting the profile id to edit.</span>
<span class="k">if</span> <span class="s1">&#39;Disk Path&#39;</span> <span class="ow">in</span> <span class="n">configuration</span><span class="p">:</span>
    <span class="n">profileId</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;profileId&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationValues&#39;</span><span class="p">]</span>
                 <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Disk Path&#39;</span> <span class="ow">and</span>
                 <span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">configuration</span><span class="p">[</span><span class="s1">&#39;Disk Path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="n">profileId</span> <span class="o">=</span> <span class="n">profileId</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;It is required an Disk Path value in the configuration.&#34;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Creating an SoftLayer_Monitoring_Agent_Configuration_Value skeleton</span>
<span class="c1"># which contains the configuration for the agent.</span>
<span class="n">configurationValues</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationValues&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;profileId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">profileId</span><span class="p">:</span>
            <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">configurationValue</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">configurationValue</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">configuration</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">configurationValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configurationValue</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">itemFound</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The configuration: &#34;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&#34; is not available for the agent.&#34;</span><span class="p">)</span>

<span class="c1"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span class="c1"># to apply the changes in the agent.</span>
<span class="c1"># Note: In case there is no changes in the agent configuration the method</span>
<span class="c1"># will return error.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">monitoringService</span><span class="o">.</span><span class="n">addConfigurationProfile</span><span class="p">(</span><span class="n">configurationValues</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div><h3 id="deactive-agent">Deactive Agent</h3>
<p>Important manual pages:</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/deactivate">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/deactivate</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Desactive an agent.
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">vsiIp</span> <span class="o">=</span> <span class="s2">&#34;169.45.98.148&#34;</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s2">&#34;DHCP Response Monitoring Agent&#34;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">agentService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>


<span class="n">objectMask</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;mask[monitoringRobot[id, robotStatus[name]], monitoringAgents[statusName, name, id], monitoringServiceEligibilityFlag, datacenter]&#34;&#34;&#34;</span>
<span class="n">vsi</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">vsiIp</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">vsi</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a vsi with the IP address: &#34;</span> <span class="o">+</span> <span class="n">vsiIp</span><span class="p">)</span>
    <span class="n">exiΩt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">agents</span> <span class="ow">in</span> <span class="n">vsi</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">agents</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">agentName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span>
        <span class="k">break</span>
<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The VSI does not have a monitor agent with the name: &#34;</span> <span class="o">+</span>  <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agentService</span><span class="o">.</span><span class="n">deactivate</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

</code></pre></div><h3 id="get-agent-configuration">Get Agent Configuration</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Get the configuration of the monitoring agent in a server or VSI.
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">ipAddres</span> <span class="o">=</span> <span class="s2">&#34;5.153.59.197&#34;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">objectMask</span> <span class="o">=</span> <span class="s1">&#39;mask[monitoringAgents[configurationTemplate[configurationSections[subSections]],&#39;</span> \
                 <span class="s1">&#39;configurationValues[id, value, profileId, agentId, configurationDefinitionId,&#39;</span> \
                 <span class="s1">&#39;profile, definition[attributes, section, valueType]]]]&#39;</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span class="o">+</span> <span class="n">ipAddres</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to get the server: faultCode=</span><span class="si">%s</span><span class="s2">, faultString=</span><span class="si">%s</span><span class="s2">&#34;</span>        
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># We will get the configuration of the active agents</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;statusName&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;Active&#34;</span><span class="p">]</span>
<span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agents</span>

<span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationTemplate&#39;</span><span class="p">][</span><span class="s1">&#39;configurationSections&#39;</span><span class="p">]:</span>
        <span class="n">sect</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">subsects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hasProfile</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">profileIds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">confs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">subsection</span> <span class="ow">in</span> <span class="n">section</span><span class="p">[</span><span class="s1">&#39;subSections&#39;</span><span class="p">]:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationValues&#39;</span><span class="p">]</span> <span class="k">if</span>
                      <span class="n">value</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;sectionId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subsection</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">conf</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;profileId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
                    <span class="n">conf</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                    <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hasProfile</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">profileIds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;profileId&#39;</span><span class="p">])</span>      
        <span class="n">sect</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hasProfile</span><span class="p">:</span>
            <span class="n">sect</span><span class="p">[</span><span class="s1">&#39;configuration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">confs</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sect</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">profileIds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">profileIds</span><span class="p">))</span>
            <span class="n">profiles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">profileId</span> <span class="ow">in</span> <span class="n">profileIds</span><span class="p">:</span>
                <span class="n">profile</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">valueConfs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">valueProfiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationValues&#39;</span><span class="p">]</span> <span class="k">if</span>
                                 <span class="n">value</span><span class="p">[</span><span class="s1">&#39;profileId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">profileId</span><span class="p">]</span>
                <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valueProfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;profile&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">valueProfile</span> <span class="ow">in</span> <span class="n">valueProfiles</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">valueProfile</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">valueProfile</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                    <span class="n">valueConfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;configuration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valueConfs</span>
                <span class="n">profiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
            <span class="n">sect</span><span class="p">[</span><span class="s1">&#39;profiles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profiles</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sect</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;sections&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sections</span>
    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>

</code></pre></div><h3 id="get-monitoring-graph-data">Get monitoring graph data</h3>
<p>The script gets the CPU usage in a selected date range.</p>
<p>Important manual pages.</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Get the graph data from a monitoring agent
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>

<span class="c1"># This data can take a little while to obtain for long date ranges</span>
<span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">12000</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">Creating an skeleton SoftLayer_Container_Metric_Data_Type object
</span><span class="s2">which represent the metric data that we will get.
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">metricDataTypes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&#34;summaryType&#34;</span><span class="p">:</span> <span class="s2">&#34;average&#34;</span><span class="p">,</span>
        <span class="s2">&#34;keyName&#34;</span><span class="p">:</span> <span class="s2">&#34;CDM_CPU_USAGE&#34;</span><span class="p">,</span>
        <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;cdm_cpu_usage_U3lzdGVt&#34;</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="c1"># The start date for the graph data</span>
<span class="n">starDate</span> <span class="o">=</span> <span class="s2">&#34;2014-09-29T01:48:08.474Z&#34;</span>
<span class="c1"># The end date for the graph data</span>
<span class="n">endDate</span> <span class="o">=</span> <span class="s2">&#34;2014-09-29T01:53:08.474Z&#34;</span>
<span class="s2">&#34;&#34;&#34;
</span><span class="s2">The agent ID from where we want to get the graph data
</span><span class="s2">to get the monitor agents in your virtual guest
</span><span class="s2">call the SoftLayer_Virtual_Guest::getMonitoringAgents method
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">agentId</span> <span class="o">=</span> <span class="mi">1448912</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">)</span>
<span class="n">monitorAgentService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>
<span class="c1"># calling the Softlayer_Monitoring_Agent::getGraphData method</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">monitorAgentService</span><span class="o">.</span><span class="n">getGraphData</span><span class="p">(</span>
    <span class="n">metricDataTypes</span><span class="p">,</span> <span class="n">starDate</span><span class="p">,</span> <span class="n">endDate</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">agentId</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div><h3 id="view-agent-report">View Agent Report</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/Monitoring_Agent_Configuration_Value/getMetricDataType">http://sldn.softlayer.com/reference/services/Monitoring_Agent_Configuration_Value/getMetricDataType</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">View the reports for the  &#34;CPU&#34; section from the
</span><span class="s2">&#39;Cpu, Disk, and Memory Monitoring Agent&#39; monitor agent.
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># The IP address of the server or VSI to configure.</span>
<span class="n">ipAddres</span> <span class="o">=</span> <span class="s2">&#34;5.153.59.197&#34;</span>

<span class="n">startDate</span> <span class="o">=</span> <span class="s1">&#39;2016-01-02&#39;</span>
<span class="n">endDate</span> <span class="o">=</span> <span class="s1">&#39;2016-01-08&#39;</span>

<span class="c1"># Set &#34;True&#34; the reports you wish to see.</span>
<span class="n">reports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Graph System CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;False&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph Total CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;False&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph User CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;False&#34;</span><span class="p">,</span>
    <span class="s1">&#39;Graph I/O Wait CPU Usage&#39;</span><span class="p">:</span> <span class="s2">&#34;True&#34;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># The agent&#39;s name we wish to see the reports.</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s1">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>
<span class="n">monitoringService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>
<span class="n">agentConfigurationService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Monitoring_Agent_Configuration_Value&#39;</span><span class="p">]</span>

<span class="c1"># Getting the monitoring agents installed in the server or VSI.</span>

<span class="c1"># Setting an object mask to retrieve information about the monitoring agents.</span>
<span class="n">objectMask</span> <span class="o">=</span> <span class="s1">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipAddres</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span class="o">+</span> <span class="n">ipAddres</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Getting the agent to see the reports.</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent</span> <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">agentName</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to find the agent: &#34;</span> <span class="o">+</span> <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Creating the list of SoftLayer_Container_Metric_Data_Type objects</span>
<span class="n">metricDataTypes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">reports</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">reports</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">:</span>
        <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;configurationValues&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">itemFound</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&#34;TRUE&#34;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">metrics</span> <span class="o">=</span> <span class="n">agentConfigurationService</span><span class="o">.</span><span class="n">getMetricDataType</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                        <span class="n">metricDataTypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to get the metrics. &#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The report: &#34;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&#34; is disable for the agent. Please review the agent configuration.&#34;</span><span class="p">)</span>
                    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">itemFound</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The configuration: &#34;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s2">&#34; is not available for the agent.&#34;</span><span class="p">)</span>

<span class="c1"># Getting the reports.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">monitoringService</span><span class="o">.</span><span class="n">getGraphData</span><span class="p">(</span><span class="n">metricDataTypes</span><span class="p">,</span> <span class="n">startDate</span><span class="p">,</span> <span class="n">endDate</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
</code></pre></div><h3 id="create-ping-monitor">Create Ping Monitor</h3>
<p>The script creates a Network Notification of type  service ping
and a notify wait of 5 minutes.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Create Network Notification
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="c1"># Declare the API client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">networkMonitorService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Network_Monitor_Version1_Query_Host&#39;</span><span class="p">]</span>

<span class="n">objectTemplate</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&#34;guestId&#34;</span><span class="p">:</span> <span class="mi">6143038</span><span class="p">,</span>
        <span class="s2">&#34;ipAddress&#34;</span><span class="p">:</span> <span class="s2">&#34;10.104.50.118&#34;</span><span class="p">,</span>
        <span class="s2">&#34;queryTypeId&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&#34;responseActionId&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&#34;waitCycles&#34;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
<span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">networkMonitorService</span><span class="o">.</span><span class="n">createObjects</span><span class="p">(</span><span class="n">objectTemplate</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div><h3 id="redeploy-or-restart-agent">Redeploy or Restart Agent</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Re-deploy an agent.
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">vsiIp</span> <span class="o">=</span> <span class="s2">&#34;169.45.98.148&#34;</span>
<span class="n">agentName</span> <span class="o">=</span> <span class="s2">&#34;DHCP Response Monitoring Agent&#34;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">vsiService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Virtual_Guest&#39;</span><span class="p">]</span>
<span class="n">agentService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Monitoring_Agent&#39;</span><span class="p">]</span>


<span class="n">objectMask</span> <span class="o">=</span> <span class="s2">&#34;mask[monitoringRobot[id, robotStatus[name]], monitoringAgents[statusName, name, id], monitoringServiceEligibilityFlag, datacenter]&#34;</span>
<span class="n">vsi</span> <span class="o">=</span> <span class="n">vsiService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">vsiIp</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">vsi</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;There is no a vsi with the IP address: &#34;</span> <span class="o">+</span> <span class="n">vsiIp</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">agents</span> <span class="ow">in</span> <span class="n">vsi</span><span class="p">[</span><span class="s1">&#39;monitoringAgents&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">agents</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">agentName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span>
        <span class="k">break</span>
<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">agent</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The VSI does not have a monitor agent with the name: &#34;</span> <span class="o">+</span>  <span class="n">agentName</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">configuration</span> <span class="o">=</span> <span class="n">agentService</span><span class="o">.</span><span class="n">getConfigurationTemplate</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agentService</span><span class="o">.</span><span class="n">deployMonitoringAgent</span><span class="p">(</span><span class="n">configuration</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="nb">id</span><span class="o">=</span><span class="n">agent</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="c1"># Restarts the Agent instead</span>
<span class="c1"># result = agentService.restartMonitoringAgent(id=agent[&#39;id&#39;])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
</code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20python%20-%20Monitoring%20Agent%20Management&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fpython%2fsoftlayer_monitoring%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
            </p>
    </div>
</div>
        </div>
    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2020<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
