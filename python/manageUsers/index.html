<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Manage Users - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/python/manageUsers/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPZ9ZBSJE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9XPZ9ZBSJE', { 'anonymize_ip': false });
}
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>August 8, 2018<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_User_Customer">SoftLayer_User_Customer</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest">SoftLayer_Virtual_Guest</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Account">SoftLayer_Account</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/ordering">ordering</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/users">users</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/permissions">permissions</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Manage Users</h1>
                    <small>A script to create users and a script to disable users. Used mostly for setting up lab users and then cleaning up after.</small>
                </div>
				
                
				
                <p>This example is a set of scripts I&rsquo;ve used for creating and disabling users.</p>
<p>Some of this functionality is also in the <a href="https://softlayer-python.readthedocs.io/en/latest/cli/users.html">SLCLI</a> now.</p>
<h2 id="create-users">Create Users</h2>
<p>Creates a user, sets up proper permissions, sets up devices access restrictions, creates API keys and orders the user a server.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">SoftLayer.API</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_template</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;firstName&#39;</span><span class="p">:</span> <span class="s1">&#39;API&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;lastName&#39;</span><span class="p">:</span> <span class="s1">&#39;Learner&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;someone@somewhere.com&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;companyName&#39;</span><span class="p">:</span> <span class="s1">&#39;IBM&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;address1&#39;</span><span class="p">:</span> <span class="s1">&#39;123 api road&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;Houston&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;US&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;postalCode&#39;</span><span class="p">:</span> <span class="s1">&#39;TX 77002&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;userStatusId&#39;</span><span class="p">:</span> <span class="mi">1001</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;timezoneId&#39;</span><span class="p">:</span> <span class="mi">107</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">created_user</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">createObject</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_template</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">created_user</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_permissions</span><span class="p">(</span><span class="n">_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">permissions</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getPermissions</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">permissions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">set_permissions</span><span class="p">(</span><span class="n">_id</span><span class="p">,</span> <span class="n">permissions</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    To get permissions correct, I take the existing permissions of a user
</span></span></span><span class="line"><span class="cl"><span class="s2">    that I already have, and set my new user&#39;s permissions to be the same
</span></span></span><span class="line"><span class="cl"><span class="s2">    with addBulkPortalPermission
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addBulkPortalPermission</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">permissions</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fix_permissions</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">permissions</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># I only want users to have access to this one host</span>
</span></span><span class="line"><span class="cl">    <span class="n">virtualGuestId</span> <span class="o">=</span> <span class="mi">22334455</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">set_permissions</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">permissions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">removeAllVirtualAccessForThisUser</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">removeAllHardwareAccessForThisUser</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addApiAuthenticationKey</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addVirtualGuestAccess</span><span class="p">(</span><span class="n">virtualGuestId</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">orderUserServer</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">apiKey</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Orders a server as the newly created user. 
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">hostname</span> <span class="o">=</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&#34;-lab-server&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;startCpus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;maxMemory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;localDiskFlag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hostname</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&#34;.lablayer.info&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;hourlyBillingFlag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;datacenter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;datacenter&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tok02&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">guest</span><span class="p">[</span><span class="s1">&#39;blockDeviceTemplateGroup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;globalIdentifier&#39;</span><span class="p">:</span> <span class="s2">&#34;6c64f59a-edeb-4ba4-b992-d04972597357&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">userClient</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">username</span> <span class="o">=</span> <span class="n">user</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">api_key</span> <span class="o">=</span> <span class="n">apiKey</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">userClient</span><span class="p">[</span><span class="s1">&#39;Virtual_Guest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">createObject</span><span class="p">(</span><span class="n">guest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Added server id: </span><span class="si">%s</span><span class="s2">  ( </span><span class="si">%s</span><span class="s2"> )&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;fullyQualifiedDomainName&#39;</span><span class="p">])</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl">    <span class="n">argsparse</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Number of users&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">argsparse</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--num-users&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;num_users&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Number of users to provision.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">argsparse</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--offset&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&#34;offset&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Username offset&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">argsparse</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--prefix&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Username prefix&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">argsparse</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">##### CHANGE THESE ##########</span>
</span></span><span class="line"><span class="cl">    <span class="n">template_user_id</span> <span class="o">=</span> <span class="mi">123456</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;APAsswordGoes!!!H3r3&#39;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">userPerms</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getPermissions</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">template_user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="n">start_user_num</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">offset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">num_users</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">target_username</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span><span class="n">start_user_num</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_user</span> <span class="o">=</span> <span class="n">create_user</span><span class="p">(</span><span class="n">target_username</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">fix_permissions</span><span class="p">(</span><span class="n">new_user</span><span class="p">,</span><span class="n">userPerms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">addApiAuthenticationKey</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">new_user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">            If the user already exists, an exception is thrown. 
</span></span></span><span class="line"><span class="cl"><span class="s2">            Just reset their permissions and continue on.
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">oFilter</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">            <span class="n">oFilter</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">            <span class="n">oFilter</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">            <span class="n">oFilter</span><span class="p">[</span><span class="s1">&#39;users&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">][</span><span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_username</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_user</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getUsers</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">oFilter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">fix_permissions</span><span class="p">(</span><span class="n">new_user</span><span class="p">,</span><span class="n">userPerms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">newApiKey</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getApiAuthenticationKeys</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">new_user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;username = </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newApiKey</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;api_key =  </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newApiKey</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;authenticationKey&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">orderUserServer</span><span class="p">(</span><span class="n">newApiKey</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">],</span><span class="n">newApiKey</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;authenticationKey&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">start_user_num</span> <span class="o">=</span> <span class="n">start_user_num</span> <span class="o">+</span> <span class="mi">1</span>
</span></span></code></pre></div><h2 id="disable-users">Disable Users</h2>
<p>Disable user, changes their password, cancels their servers, and removes any sshKeys</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">SoftLayer.API</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_target_users</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">_filter</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;operation&#39;</span><span class="p">:</span> <span class="s1">&#39;*= </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">_mask</span> <span class="o">=</span> <span class="s2">&#34;mask[id,username]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">_users</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getUsers</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">_filter</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">_mask</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">_users</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_target_keys</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">_filter</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;sshKeys&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;operation&#39;</span><span class="p">:</span> <span class="s1">&#39;*= </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">_mask</span> <span class="o">=</span> <span class="s2">&#34;mask[id,label]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">_users</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getSshKeys</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">_filter</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">_mask</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">_users</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">thing</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;OK&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;ERROR: &#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">pp</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl">    <span class="n">argsparse</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Number of users&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">argsparse</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--prefix&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Username prefix&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">argsparse</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--password&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">help</span><span class="o">=</span><span class="s1">&#39;New Password&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">argsparse</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">users</span> <span class="o">=</span> <span class="n">get_target_users</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">password</span> <span class="o">=</span>  <span class="n">args</span><span class="o">.</span><span class="n">password</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="s1">&#39;User: &#39;</span> <span class="o">+</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; Password: &#39;</span> <span class="o">+</span> <span class="n">password</span> 
</span></span><span class="line"><span class="cl">        <span class="c1"># status 1021 disables the user</span>
</span></span><span class="line"><span class="cl">        <span class="n">template</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;userStatusId&#39;</span><span class="p">:</span> <span class="mi">1021</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Cancel any servers the user created</span>
</span></span><span class="line"><span class="cl">        <span class="n">servers</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getVirtualGuests</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">virt</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="c1"># the &#34;,&#34; and the end of print removes the automatic newline</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">Canceling host... &#34;</span> <span class="o">+</span> <span class="n">virt</span><span class="p">[</span><span class="s1">&#39;fullyQualifiedDomainName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34; (&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">virt</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34;)</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Virtual_Guest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deleteObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">virt</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="n">print_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">virt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">Exception, host might already be canceling...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">pp</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\t</span><span class="s2">Changing password for...&#34;</span> <span class="o">+</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34; (&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34;)</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;User_Customer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">updatePassword</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">print_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="n">sshkeys</span> <span class="o">=</span> <span class="n">get_target_keys</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="s1">&#39;SSH Key Removal&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sshkeys</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Deleting key... &#34;</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34; (&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&#34;)</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Security_Ssh_Key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">deleteObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">key</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">print_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="s1">&#39;Complete&#39;</span>
</span></span></code></pre></div><h2 id="users-statuses">Users Statuses</h2>
<p>The following statuses are available for users:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ slcli call-api SoftLayer_User_Customer_Status getAllObjects
</span></span><span class="line"><span class="cl">ID    KeyName         Description
</span></span><span class="line"><span class="cl">1001  ACTIVE          Active
</span></span><span class="line"><span class="cl">1002  DISABLED        Disabled
</span></span><span class="line"><span class="cl">1003  INACTIVE        Inactive
</span></span><span class="line"><span class="cl">1004  PENDING         Pending
</span></span><span class="line"><span class="cl">1005  SUSPENDED       Suspended
</span></span><span class="line"><span class="cl">1006  IAMID_INVALID   IAMid Invalid
</span></span><span class="line"><span class="cl">1021  CANCEL_PENDING  cancel_pending
</span></span><span class="line"><span class="cl">1022  VPN_ONLY        VPN Only
</span></span></code></pre></div><p>When a user is set to CANCEL_PENDING, they will now show up in the API results or portal, however the users will still technically exist in the database. So if you try to create another user with the same username, you may get an error.</p>

            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20python%20-%20Manage%20Users&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fpython%2fmanageUsers%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
            </p>
    </div>
</div>
        </div>
    </div>
<footer>
    <div class="row">
        <div class="col-sm-12">
            <p>&copy; SoftLayer 2023<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
