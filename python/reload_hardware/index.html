<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Reload Server Examples - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/python/reload_hardware/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-88235803-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>January 28, 2016<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server">SoftLayer_Hardware_Server</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Component_HardDrive">SoftLayer_Hardware_Component_HardDrive</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/reload">reload</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/server">server</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/deprecated">deprecated</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/sshkeys">sshkeys</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/hardware">hardware</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Reload Server Examples</h1>
                    <small>A variety of ways to perform an OS reload on bare metal servers</small>
                </div>
				
                
                    <div class="alert alert-info alert-dismissable" style="margin-top:25px;margin-bottom:5px;">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        <strong>Hey, listen!</strong><br>
                        This example contains deprecated methods or syntax and needs to be updated. Please use caution when using.
                    </div>
                
				
                <p>This article covers a few ways to reload bare metal servers. This article is marked depreciated because of its use of Flex Image Templates, the other ways to reload operating systems are still valid.</p>
<h3 id="list-flex-image-templates"><strong>List Flex Image Templates</strong></h3>
<blockquote>
<p>Flex Images are depreciated as of 8/7/2017. <a href="https://knowledgelayer.softlayer.com/learning/softlayer-product-life-cycle-policy">SoftLayer Product Lifecycle</a></p>
</blockquote>
<p>Reloading a hardware server from an image template allows users to restore or reconfigure the server based off a pre-existing Flex Image Template that is associated with the account in use.</p>
<p>To retrieve the list of available Flex Image Template in the account it is required to use object-filters over the method SoftLayer_Account::getPrivateBlockDeviceTemplateGroups as following</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>

<span class="k">class</span> <span class="nc">example</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="c1"># Object-filter which is used to retrieve Flex Images</span>
        <span class="n">_filter</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;privateBlockDeviceTemplateGroups&#34;</span><span class="p">:{</span><span class="s2">&#34;imageTypeKeyName&#34;</span><span class="p">:{</span><span class="s2">&#34;operation&#34;</span><span class="p">:</span><span class="s2">&#34;DISK_CAPTURE&#34;</span><span class="p">}}}</span>
        
        <span class="c1"># object-mask to retrieve only the id and name of the image</span>
        <span class="n">_mask</span> <span class="o">=</span> <span class="s2">&#34;mask[id,name]&#34;</span>

        <span class="n">accountService</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span>
        <span class="c1"># Retrieve all Flex Images in the account</span>
        <span class="n">images</span> <span class="o">=</span> <span class="n">accountService</span><span class="o">.</span><span class="n">getPrivateBlockDeviceTemplateGroups</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">_filter</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">_mask</span><span class="p">)</span>

        <span class="n">pp</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">main</span> <span class="o">=</span> <span class="n">example</span><span class="p">()</span>
    <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>

</code></pre></div><h3 id="load-hardware-server-from-flex-image-template"><strong>Load Hardware Server from Flex Image Template</strong></h3>
<p>SoftLayer does not perform internal backups of customer devices, so the data in the device cannot be retrieved after the OS Reload is initiated. Back up all data on the device prior to initiating the OS Reload.</p>
<p>Post Install Script, SSH Keys, Reset IPMI Password, Apply Motherboard BIOS upgrades, Apply firmware updates for all hard drives, etc., are some of the features that can be added in the server configuration, it is recommended to review <a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Hardware_Server_Configuration">Container_Hardware_Server_Configuration</a> in order know which additional features can be added.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>

<span class="k">class</span> <span class="nc">example</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ID of server which will be reloaded</span>
        <span class="n">serverId</span> <span class="o">=</span> <span class="mi">102938</span>        
        <span class="c1"># Flex Image ID</span>
        <span class="n">imageId</span> <span class="o">=</span> <span class="mi">1234567</span>
        
        <span class="n">sshKey1</span> <span class="o">=</span> <span class="mi">123</span>
        <span class="n">sshKey2</span> <span class="o">=</span> <span class="mi">456</span>

        <span class="c1"># Build reload configuration        </span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;imageTemplateId&#39;</span><span class="p">:</span> <span class="n">imageId</span><span class="p">,</span> 
            <span class="s1">&#39;sshKeyIds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sshKey1</span><span class="p">,</span> <span class="n">sshKey2</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;Hardware_Server&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reloadOperatingSystem</span><span class="p">(</span><span class="s1">&#39;FORCE&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">serverId</span><span class="p">)</span>

        <span class="n">pp</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&#34;RESULT</span><span class="se">\n</span><span class="s2">&#34;</span>
        <span class="n">pp</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">main</span> <span class="o">=</span> <span class="n">example</span><span class="p">()</span>
    <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>

</code></pre></div><h3 id="reload-from-a-list-of-ip-addresses">Reload from a list of IP addresses</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Reload servers from a list of IPs
</span><span class="s2">
</span><span class="s2">This script looks for a server with a determinate IP address and reloads
</span><span class="s2">the Operative System with another one.
</span><span class="s2">
</span><span class="s2">It makes a single call to the reloadOperatingSystem() method in the
</span><span class="s2">SoftLayer_Hardware_Server API service
</span><span class="s2">
</span><span class="s2">Important manual pages:
</span><span class="s2">https://softlayer.github.io/reference/datatypes/SoftLayer_Hardware_Server
</span><span class="s2">https://softlayer.github.io/reference/services/SoftLayer_Hardware_Server/findByIpAddress
</span><span class="s2">https://softlayer.github.io/reference/services/SoftLayer_Hardware_Server/reloadOperatingSystem
</span><span class="s2">
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>

<span class="c1"># The IP addresses you wish to reload</span>
<span class="n">ipsToReload</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;159.8.52.190&#39;</span><span class="p">]</span>

<span class="c1"># The new OS you wish to load</span>
<span class="n">newOSToLoad</span> <span class="o">=</span> <span class="s1">&#39;CentOS 6.x - Minimal Install (64 bit)&#39;</span>


<span class="c1"># Declare a new API service objects for: SoftLayer_Hardware_Server</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">create_client_from_env</span><span class="p">()</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">Add an object mask to retrieve our prices related to the servers
</span><span class="s2">https://softlayer.github.io/reference/datatypes/SoftLayer_Hardware_Server
</span><span class="s2">for a list of the relational properties you can retrieve along with hardware.
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">objectMask</span> <span class="o">=</span> <span class="s2">&#34;mask[billingItem[package[items[prices]]]]&#34;</span>

<span class="c1"># the list of servers to reload</span>
<span class="n">serversToReload</span> <span class="o">=</span> <span class="p">{}</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">We are looking for the server with the specified IP addresses
</span><span class="s2">and the price for the new OS to load
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ipToReload</span> <span class="ow">in</span> <span class="n">ipsToReload</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipToReload</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
        <span class="n">serversToReload</span><span class="p">[</span><span class="n">ipToReload</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">serversToReload</span><span class="p">[</span><span class="n">ipToReload</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;billingItem&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">server</span><span class="p">[</span><span class="s2">&#34;billingItem&#34;</span><span class="p">][</span><span class="s2">&#34;package&#34;</span><span class="p">][</span><span class="s2">&#34;items&#34;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">newOSToLoad</span><span class="p">:</span>
                    <span class="n">serversToReload</span><span class="p">[</span><span class="n">ipToReload</span><span class="p">][</span><span class="s1">&#39;priceId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;prices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                    <span class="k">break</span>
    <span class="c1"># we are calling the reloadOperatingSystem for the desired servers</span>
    <span class="k">for</span> <span class="n">ipToReload</span> <span class="ow">in</span> <span class="n">ipsToReload</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;itemPrices&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">serversToReload</span><span class="p">[</span><span class="n">ipToReload</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="n">reload</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">reloadOperatingSystem</span><span class="p">(</span><span class="s1">&#39;FORCE&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">serversToReload</span><span class="p">[</span><span class="n">ipToReload</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">reload</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unable to reload the bare metal servers: </span><span class="se">\n</span><span class="s2">faultCode= </span><span class="si">%s</span><span class="s2">, </span><span class="se">\n</span><span class="s2">faultString= </span><span class="si">%s</span><span class="s2">&#34;</span>
          <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div><h3 id="changing-software-options-during-a-reload">Changing Software options during a reload</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Reload servers from a list of IPs, with the option to specify some additional software
</span><span class="s2">
</span><span class="s2">
</span><span class="s2">Important manual pages:
</span><span class="s2">https://softlayer.github.io/reference/datatypes/SoftLayer_Hardware_Server
</span><span class="s2">https://softlayer.github.io/reference/services/SoftLayer_Hardware_Server/findByIpAddress
</span><span class="s2">https://softlayer.github.io/reference/services/SoftLayer_Hardware_Server/reloadOperatingSystem
</span><span class="s2">&#34;&#34;&#34;</span>

<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="k">def</span> <span class="nf">get_price</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">item_name</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Get the price for an item.
</span><span class="s2">        :param SoftLayer_Hardware_Server server: The server to reload.
</span><span class="s2">        :param string item_name: The item name to get the price.
</span><span class="s2">        :returns: A Softlayer_Product_Item_Price object.
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">server</span><span class="p">[</span><span class="s1">&#39;billingItem&#39;</span><span class="p">][</span><span class="s1">&#39;package&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">item_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">prices</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;prices&#39;</span><span class="p">]</span>
                <span class="k">break</span>
    <span class="n">price</span> <span class="o">=</span> <span class="p">[</span><span class="n">price</span> <span class="k">for</span> <span class="n">price</span> <span class="ow">in</span> <span class="n">prices</span> <span class="k">if</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;locationGroupId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">price</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">price</span>


<span class="n">ipsToReload</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;159.8.52.190&#39;</span><span class="p">,</span> <span class="s1">&#39;10.104.213.250&#39;</span><span class="p">]</span>

<span class="c1"># The configuration for the reload.</span>
<span class="c1"># The values with empty value will not included in the reload request.</span>
<span class="n">newOSToLoad</span> <span class="o">=</span> <span class="s1">&#39;CentOS 6.x (64 bit)&#39;</span>
<span class="n">newOsAddom</span> <span class="o">=</span> <span class="s1">&#39;XenServer Enterprise for XenServer 5.6&#39;</span>
<span class="n">newControlPanel</span> <span class="o">=</span> <span class="s1">&#39;cPanel/WHM with Softaculous and RVskin&#39;</span>
<span class="n">newDatabase</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">newAntivir</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">newFirewall</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">customProvisionScriptUri</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">resetIpmiPassword</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">upgradeBios</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">upgradeHardDriveFirmware</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Partitions for the reload. If you do not want specify partitions set the value empty hardDrives = []</span>
<span class="c1"># Each partition must have at least its name and minimumSize defined.</span>
<span class="c1"># Name defines your partition&#39;s mount point, and minimumSize specifies its size</span>
<span class="c1"># in gigabytes.</span>
<span class="c1"># UNIX partition schemes must have at least one swap partition, defined by the</span>
<span class="c1"># partition name /swap0. Set the partition&#39;s grow property to 1 to indicate that</span>
<span class="c1"># partition should expand to fill the remainder of the disk. You must have one</span>
<span class="c1"># grow partition in your partition scheme.</span>
<span class="c1"># Windows partitioning is a little simpler. Specify the C: partition with the</span>
<span class="c1"># name /os, with drives letters D:, E:, F:, etc as /disk0, /disk1, /disk2, and</span>
<span class="c1"># so on.</span>
<span class="c1"># This example sets up the following partition scheme:</span>
<span class="c1">#  * swap: 1G</span>
<span class="c1">#  * /boot: 100M</span>
<span class="c1">#  * /test: 15G</span>
<span class="c1">#  * /:  grown to fill disk space</span>
<span class="n">hardDrives</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;complexType&#39;</span><span class="p">:</span> <span class="s1">&#39;SoftLayer_Hardware_Component_HardDrive&#39;</span><span class="p">,</span>
        <span class="s1">&#39;partitions&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;/swap0&#39;</span><span class="p">,</span>
                <span class="s1">&#39;minimumSize&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;/boot&#39;</span><span class="p">,</span>
                <span class="s1">&#39;minimumSize&#39;</span><span class="p">:</span> <span class="s1">&#39;.1&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;/test&#39;</span><span class="p">,</span>
                <span class="s1">&#39;minimumSize&#39;</span><span class="p">:</span> <span class="s1">&#39;15&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
                <span class="s1">&#39;minimumSize&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;grow&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">create_client_from_env</span><span class="p">()</span>
<span class="n">hardwareService</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;SoftLayer_Hardware_Server&#39;</span><span class="p">]</span>

<span class="n">objectMask</span> <span class="o">=</span> <span class="s2">&#34;mask[account[attributes[accountAttributeType]], activeTransaction[transactionStatus], &#34;</span> \
             <span class="s2">&#34;billingItem[item[totalPhysicalCoreCapacity, capacity], &#34;</span> \
             <span class="s2">&#34;package[configuration[itemCategory[categoryCode, name]], &#34;</span> \
             <span class="s2">&#34;items[availabilityAttributes[attributeTypeKeyName], coreRestrictedItemFlag, prices[accountRestrictions,&#34;</span> \
             <span class="s2">&#34;categories[categoryCode, name], requiredCoreCount, definedSoftwareLicenseFlag], requirements, &#34;</span> \
             <span class="s2">&#34;softwareDescription[averageInstallationDuration]]]], hourlyBillingFlag, managedResourceFlag, &#34;</span> \
             <span class="s2">&#34;operatingSystem[averageInstallationDuration, passwords[sshKeys]], primaryIpAddress, &#34;</span> \
             <span class="s2">&#34;softwareComponents[softwareLicense[softwareDescription[features[keyName], &#34;</span> \
             <span class="s2">&#34;productItems[categories[categoryCode, name]]]]], networkGatewayMemberFlag]&#34;</span>

<span class="n">failedServers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ipToReload</span> <span class="ow">in</span> <span class="n">ipsToReload</span><span class="p">:</span>
    <span class="n">failedServer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="n">ipToReload</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">findByIpAddress</span><span class="p">(</span><span class="n">ipToReload</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">objectMask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">server</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">failedServer</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;Ip does not exist.&#34;</span>
            <span class="n">failedServers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">failedServer</span><span class="p">)</span>
            <span class="k">continue</span>
    <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failedServer</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">failedServers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">failedServer</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="s1">&#39;activeTransaction&#39;</span> <span class="ow">in</span> <span class="n">server</span><span class="p">:</span>
        <span class="n">failedServer</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;There is an active transaction.&#34;</span>
        <span class="n">failedServers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">failedServer</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="n">priceOs</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">newOSToLoad</span><span class="p">)</span>
    <span class="n">priceOsAddom</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">newOsAddom</span><span class="p">)</span>
    <span class="n">pricePanel</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">newControlPanel</span><span class="p">)</span>
    <span class="n">priceDataBase</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">newDatabase</span><span class="p">)</span>
    <span class="n">priceAntivir</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">newAntivir</span><span class="p">)</span>
    <span class="n">priceFirewall</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">newFirewall</span><span class="p">)</span>
    <span class="n">itemPrices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">priceOs</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">itemPrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priceOs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">priceOsAddom</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">itemPrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priceOsAddom</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pricePanel</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">itemPrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pricePanel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">priceDataBase</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">itemPrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priceDataBase</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">priceAntivir</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">itemPrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priceAntivir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">priceFirewall</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">itemPrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priceFirewall</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;itemPrices&#39;</span><span class="p">:</span> <span class="n">itemPrices</span><span class="p">,</span>
        <span class="s1">&#39;resetIpmiPassword&#39;</span><span class="p">:</span> <span class="n">resetIpmiPassword</span><span class="p">,</span>
        <span class="s1">&#39;upgradeBios&#39;</span><span class="p">:</span> <span class="n">upgradeBios</span><span class="p">,</span>
        <span class="s1">&#39;upgradeHardDriveFirmware&#39;</span><span class="p">:</span> <span class="n">upgradeHardDriveFirmware</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">customProvisionScriptUri</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;customProvisionScriptUri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">customProvisionScriptUri</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hardDrives</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;hardDrives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hardDrives</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">reload</span> <span class="o">=</span> <span class="n">hardwareService</span><span class="o">.</span><span class="n">reloadOperatingSystem</span><span class="p">(</span><span class="s1">&#39;FORCE&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">server</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Se inició el proceso de Os Reload&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">reload</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failedServer</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">failedServers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">failedServer</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The reload failed for these IPs:&#34;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">failedServers</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;: &#39;</span><span class="p">)))</span>
</code></pre></div><h3 id="reload-with-custom-partitions">Reload with custom partitions</h3>
<p>The following code allows you to reload a Bare Metal server with a custom partitioning scheme. You simply need to change the serverId and the partitions to suit your needs. Note that one partition must be marked as the &lsquo;grow&rsquo; partition.</p>
<p>Options for the configuration can be found at the  <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Hardware_Server_Configuration/">SoftLayer_Container_Hardware_Server_Configuration</a> datatype</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>

<span class="k">class</span> <span class="nc">example</span><span class="p">():</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">serverId</span> <span class="o">=</span> <span class="mi">1154505</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&#34;upgradeHardDriveFirmware&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&#34;upgradeBios&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&#34;hardDrives&#34;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&#34;complexType&#34;</span><span class="p">:</span> <span class="s2">&#34;SoftLayer_Hardware_Component_HardDrive&#34;</span><span class="p">,</span>
                <span class="s2">&#34;partitions&#34;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;/boot&#34;</span><span class="p">,</span> <span class="s2">&#34;minimumSize&#34;</span><span class="p">:</span> <span class="s2">&#34;.25&#34;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;/swap0&#34;</span><span class="p">,</span> <span class="s2">&#34;minimumSize&#34;</span><span class="p">:</span> <span class="s2">&#34;20&#34;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="s2">&#34;minimumSize&#34;</span><span class="p">:</span> <span class="s2">&#34;200&#34;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;/tmp&#34;</span><span class="p">,</span> <span class="s2">&#34;minimumSize&#34;</span><span class="p">:</span> <span class="s2">&#34;200&#34;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;/var&#34;</span><span class="p">,</span> <span class="s2">&#34;minimumSize&#34;</span><span class="p">:</span> <span class="s2">&#34;200&#34;</span><span class="p">},</span>
                    <span class="p">{</span> <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;/remove&#34;</span><span class="p">,</span> <span class="s2">&#34;minimumSize&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="s2">&#34;grow&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&#34;lvmFlag&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">[</span><span class="s1">&#39;Hardware_Server&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reloadOperatingSystem</span><span class="p">(</span><span class="s1">&#39;FORCE&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">serverId</span><span class="p">)</span>

        <span class="n">pp</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&#34;RESULT</span><span class="se">\n</span><span class="s2">&#34;</span>
        <span class="n">pp</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">main</span> <span class="o">=</span> <span class="n">example</span><span class="p">()</span>
    <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
    <div class="well well-sm" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20python%20-%20Reload%20Server%20Examples&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fpython%2freload_hardware%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
            </p>
    </div>
</div>
        </div>
    </div>
<footer>
    <div class="row">
        <div class="col-sm-12">
            <p>&copy; SoftLayer 2022<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
