<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>get_device_configuration_upgrade.py - https://softlayer.github.io/</title>
    <link rel="canonical" href="https://softlayer.github.io/python/get_device_configuration_upgrade.py/">
        <link href="https://softlayer.github.io/css/main.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/bootstrap.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/fa-svg-with-js.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/custom.css" rel="stylesheet">
    <link href="https://softlayer.github.io/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://softlayer.github.io/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://softlayer.github.io/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://softlayer.github.io/js/jquery-3.3.1.min.js"></script> 
    <script src="https://softlayer.github.io/js/sldn.js"></script>
    <script src="https://softlayer.github.io/js/fontawesome-all.js"></script>

    
	<script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-88235803-1', 'auto');
ga('send', 'pageview');
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://softlayer.github.io/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://softlayer.github.io/article/">Articles</a></li>
                    
                        <li><a href="https://softlayer.github.io/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://softlayer.github.io/go/">Go</a></li>
                    
                        <li><a href="https://softlayer.github.io/php/">PHP</a></li>
                    
                        <li><a href="https://softlayer.github.io/perl/">Perl</a></li>
                    
                        <li><a href="https://softlayer.github.io/python/">Python</a></li>
                    
                        <li><a href="https://softlayer.github.io/rest/">Rest</a></li>
                    
                        <li><a href="https://softlayer.github.io/ruby/">Ruby</a></li>
                    
                        <li><a href="https://softlayer.github.io/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:softlayer.github.io" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>November 23, 2017<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://softlayer.github.io/classes/SoftLayer_Product_Item_Price">SoftLayer_Product_Item_Price</a>
                
                    <a class="label label-primary" href="https://softlayer.github.io/classes/SoftLayer_Hardware_Server">SoftLayer_Hardware_Server</a>
                
                    <a class="label label-primary" href="https://softlayer.github.io/classes/SoftLayer_Provisioning_Maintenance_Window">SoftLayer_Provisioning_Maintenance_Window</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://softlayer.github.io/tags/baremetalservers">baremetalservers</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm release-note" style="word-wrap: break-word;">
				<h3>get_device_configuration_upgrade.py<br> <small>get_device_configuration_upgrade.py</small></h3>
				
                
				
                <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&#34;&#34;&#34;
Display the hardware configuration and the items which can be modified in the server
like in the portal when the modify device configuration link is clicked in the
bare metal details page.

Important manual pages
http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress
http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/getObject
http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/getUpgradeItemPrices/getMaintenanceWindows
http://sldn.softlayer.com/reference/services/SoftLayer_Provisioning_Maintenance_Window
http://sldn.softlayer.com/reference/datatypes/SoftLayer_Hardware_Server

License: http://sldn.softlayer.com/article/License
Author: SoftLayer Technologies, Inc. &lt;sldn@softlayer.com&gt;
&#34;&#34;&#34;

import SoftLayer.API
import datetime

# Your SoftLayer API username and key.
API_USERNAME = &#39;set-me&#39;

# Generate one at https://control.softlayer.com/account/users
API_KEY = &#39;set-me&#39;

server_ip = &#34;159.8.52.185&#34;

day_maintenance = &#34;2017-10-10&#34;

client = SoftLayer.create_client_from_env(username=API_USERNAME, api_key=API_KEY)
hardware_service = client[&#39;SoftLayer_Hardware_Server&#39;]
maintenance_service = client[&#39;SoftLayer_Provisioning_Maintenance_Window&#39;]


def get_maintenance(server, day_maintenance, maintenance_service):
    &#34;&#34;&#34;Get the prices of the items to upgrade in a server.
         :param SoftLayer_Hardware_Server server: The server to get the maintenance date.
         :param string day_maintenance: The date to get the list of maintenance available.
         :param string maintenance_service: Declaring api cilent`s service.
         :returns: A array of SoftLayer_Provisioning_Maintenance_Window object.
    &#34;&#34;&#34;
    end_date = datetime.datetime.strptime(day_maintenance, &#39;%Y-%m-%d&#39;)
    start_date = end_date + datetime.timedelta(days=-1)
    result = maintenance_service.getMaintenanceWindows(str(start_date), str(end_date), server[&#39;datacenter&#39;][&#39;id&#39;])
    items = [item for item in result if day_maintenance in item[&#39;beginDate&#39;]]
    return items


def get_server(server_ip, hardware_service):
    &#34;&#34;&#34;Get the server.
         :param string server_ip: The Ip address of the server.
         :param SoftLayer_Hardware_Server hardware_service: the SoftLayer_Hardware_Server service.
         :returns: A SoftLayer_Hardware_Server object.
    &#34;&#34;&#34;
    try:
        object_mask = &#34;mask[datacenter, activeTransaction[transactionStatus], billingItem[children[category, &#34; \
                     &#34;item], orderItem[order[items]], package[configuration[itemCategory[categoryCode, name]]]],&#34; \
                     &#34; hourlyBillingFlag, managedResourceFlag, primaryIpAddress, networkGatewayMemberFlag]&#34;
        server = hardware_service.findByIpAddress(server_ip, mask=object_mask)
        if not server:
            print(&#34;There is no a server with the IP address: &#34; + server_ip)
            exit(1)
    except SoftLayer.SoftLayerAPIError as e:
        print(&#34;Unable to retrieve the server: \nfaultCode= %s, \nfaultString= %s&#34; % (e.faultCode, e.faultString))
        exit(1)
    return server


def get_upgrade_items(server, hardware_service):
    &#34;&#34;&#34;Get the prices of the items to upgrade in a server.
         :param SoftLayer_Hardware_Server server: The server to get the upgrade item prices.
         :param SoftLayer_Hardware_Server hardware_service: the SoftLayer_Hardware_Server service.
         :returns: A array of SoftLayer_Product_Item_Price object.
    &#34;&#34;&#34;
    try:
        upgrade_items = hardware_service.getUpgradeItemPrices(id=server[&#39;id&#39;])
    except SoftLayer.SoftLayerAPIError as e:
        print(&#34;Unable to retrieve the upgrade items: \nfaultCode= %s, \nfaultString= %s&#34; % (e.faultCode, e.faultString))
        exit(1)
    return upgrade_items


def get_upgrade_items_by_categories(server, upgrade_items):
    &#34;&#34;&#34;Get the prices of the items to upgrade in a server.
         :param SoftLayer_Hardware_Server server: The server to get the upgrade item prices.
         :param array of SoftLayer_Product_Item_Price upgrade_items: the item prices to upgrade.
         :returns: A array of item prices sorted by category.
    &#34;&#34;&#34;
    categories = server[&#39;billingItem&#39;][&#39;package&#39;][&#39;configuration&#39;]
    items_by_category = []
    for cat in categories:
        upgrade_category = {&#39;category&#39;: cat[&#39;itemCategory&#39;]}
        prices = []
        for item in upgrade_items:
            for cat_item in item[&#39;categories&#39;]:
                if cat_item[&#39;categoryCode&#39;] == upgrade_category[&#39;category&#39;][&#39;categoryCode&#39;]:
                    prices.append(item)
                    break
        upgrade_category[&#39;prices&#39;] = prices
        if len(prices) &gt; 0:
            current_conf = {}
            for conf in server[&#39;billingItem&#39;][&#39;children&#39;]:
                if conf[&#39;categoryCode&#39;] == upgrade_category[&#39;category&#39;][&#39;categoryCode&#39;]:
                    current_conf = conf
                    break
            upgrade_category[&#39;currentInInstalled&#39;] = current_conf
            items_by_category.append(upgrade_category)
    return items_by_category


def display_data(server, upgrade_categories, maintenances):
    &#34;&#34;&#34;Get the prices of the items to upgrade in a server.
         :param SoftLayer_Hardware_Server server: The server to get the upgrade item prices.
         :param A array of upgrade_categories: The upgrade item prices.
         :param A array of SoftLayer_Provisioning_Maintenance_Window  maintenances: The maintanance date.
    &#34;&#34;&#34;
    print(&#34;Maintenance&#34;)
    for item in maintenances:
        print(&#34; &#34; * 4 + &#34;id: &#34; + str(item[&#39;id&#39;]) + &#34; Date: &#34; + item[&#39;beginDate&#39;] + &#34; to &#34; + item[&#39;end_date&#39;])
    for item in upgrade_categories:
        print(item[&#39;category&#39;][&#39;name&#39;])
        if &#39;description&#39; in item[&#39;currentInInstalled&#39;]:
            current = item[&#39;currentInInstalled&#39;][&#39;item&#39;][&#39;description&#39;]
            current_price = {}
            for price in item[&#39;prices&#39;]:
                if price[&#39;item&#39;][&#39;description&#39;] == current:
                    current_price = price
                    break
            if not &#39;recurringFee&#39; in current_price:
                for price in item[&#39;prices&#39;]:
                    if price[&#39;categories&#39;][0][&#39;name&#39;] == item[&#39;category&#39;][&#39;name&#39;]:
                        current_price = price
                        current = price[&#39;item&#39;][&#39;description&#39;]
            if not server[&#39;hourlyBillingFlag&#39;]:
                print(&#34; &#34; * 4 + &#34;Current installed: &#34; + current + &#34; Price: &#34; +
                      current_price[&#39;recurringFee&#39;] + &#34; per month&#34;)
            else:
                print(&#34; &#34; * 4 + &#34;Current installed: &#34; + current + &#34; Price: &#34; +
                      current_price[&#39;hourlyRecurringFee&#39;] + &#34;per hour&#34;)
        else:
            current = &#39;None&#39;
            print(&#34; &#34; * 4 + &#34;Current installed: &#34; + current)
        print(&#34; &#34; * 4 + &#34;Available items:&#34;)
        for price in item[&#39;prices&#39;]:
            if price[&#39;item&#39;][&#39;description&#39;] != current:
                if not server[&#39;hourlyBillingFlag&#39;]:
                    print(&#34; &#34; * 8 + price[&#39;item&#39;][&#39;description&#39;] + &#34; Price: &#34; +
                          price[&#39;recurringFee&#39;] + &#34; per month&#34;)
                else:
                    print(&#34; &#34; * 8 + price[&#39;item&#39;][&#39;description&#39;] + &#34; Price: &#34; +
                          price[&#39;hourlyRecurringFee&#39;] + &#34; per hour&#34;)
    return

server = get_server(server_ip, hardware_service)
upgrade_items = get_upgrade_items(server, hardware_service)
upgrade_categories = get_upgrade_items_by_categories(server, upgrade_items)
maintenances = get_maintenance(server, day_maintenance, maintenance_service)
display_data(server, upgrade_categories, maintenances)</pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
            
        <div class="col-md-6">
            
<div class="panel panel-default">
    <div class="panel-heading" style="padding: 2px 15px;">
        <h4>More Documentation</h4>
    </div>
    <div class="panel-body">
        <a href="https://softlayer.github.com/reference/softlayerapi"><i class="fa fa-link"></i> SoftLayer API Reference<br></a>
        <a href="https://github.com/softlayer/softlayer-java"><i class="fab fa-github"></i> softlayer-java<br></a>
        <a href="https://github.com/softlayer/softlayer-api-perl-client"><i class="fab fa-github"></i> softlayer-perl<br></a>
        <a href="https://github.com/softlayer/softlayer-api-php-client"><i class="fab fa-github"></i> softlayer-php<br></a>
        <a href="https://github.com/softlayer/softlayer-python"><i class="fab fa-github"></i> softlayer-python<br></a>
        <a href="https://github.com/softlayer/softlayer-ruby"><i class="fab fa-github"></i> softlayer-ruby<br></a>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading text-center" style="padding: 2px 15px;">
      <a href="https://www.facebook.com/IBMBluemixIaaS/"><i class="fab fa-facebook-square" alt="facebook"></i> </a>
      <a href="https://twitter.com/IBMBluemixIaaS"><i class="fab fa-twitter" alt="twitter"></i> </a>
      <a href="http://www.linkedin.com/company/softlayer-technologies-inc-" alt="linked-in"><i class="fab fa-linkedin"></i> </a>
      <a href="https://github.com/softlayer/softlayer.github.io"><i class="fab fa-github" alt="github"></i> </a>

    </div>
</div>

        </div>
        <div class="col-md-6">
            <div class="well well-sm" style="word-wrap: break-word;"> 
                <strong>Feedback? <span class="fa fa-comment"/></strong>
                    <p>
                        We would love to hear it<br>
                        <a class="" href="https://github.com/softlayer/api_examples/issues/new?title=Feedback%20for%20python%20-%20get_device_configuration_upgrade.py&body=Feedback+regarding%3A%20https%3a%2f%2fsoftlayer.github.io%2fpython%2fget_device_configuration_upgrade.py%2f"><span class="fa fa-github-square"/> Open an issue</a>
                    </p>
            </div>
        </div>

    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2015<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://softlayer.github.io/js/jquery.js"></script>
    <script src="https://softlayer.github.io/js/bootstrap.js"></script>
</body>
</html>

/python/get_device_configuration_upgrade.py/
