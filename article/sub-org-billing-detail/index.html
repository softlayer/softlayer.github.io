<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Sub-Organization Billing Detail - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/article/sub-org-billing-detail/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">
    

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
        var head = document.getElementsByTagName('head')[0]
        var style = document.createElement('link')
        style.type = 'text/css'
        style.rel = 'stylesheet'
        style.id = "dark-theme"
        if (localStorage.getItem("dark-mode-theme") == "dark") {
            style.href = '/css/dark.css'
        } else {
            style.href = '/css/light.css'
        }
        head.append(style)
    </script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
            setThemeMode(localStorage.getItem("dark-mode-theme") || "dark");
		})
	</script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPZ9ZBSJE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9XPZ9ZBSJE', { 'anonymize_ip': false });
}
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="nav-container">
            <div class="navbar-header" style="width: 150px">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>

            <div class="navbar-header" style="width: calc(100% - 400px)">
                <ul class="nav navbar-nav" style="width: 100%">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    
                    <li class="nav-item">
                        <a id="dark-toggle" class="dark-mode-toggle" aria-label="dark-mode-toggle" style="color: var(--Red); font-size: 20px">
                            <i class="fas fa-sun"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <div id="custom-search-input" class="pull-right" style="width: 250px">
              <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                <div class="input-group col-md-12">
                  <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                  <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                  <div class="input-group-btn">
                    <button class="btn btn-info" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>

        </div>
    </nav>

<script type="text/javascript">
const darkIconClass = 'fas fa-moon'
const lightIconClass = 'fas fa-sun'
var darkCSS = $("#dark-theme");
var darkToggleIcon = $("#dark-toggle i");




function setThemeMode(mode) {
    localStorage.setItem("dark-mode-theme", mode);
    if (mode === "dark") {
        darkToggleIcon.attr('class', darkIconClass)
    } else  {
        darkToggleIcon.attr('class', lightIconClass)
    }
}


$("#dark-toggle").click(function () {
  if (darkToggleIcon.attr("class") == lightIconClass) {
    setThemeMode("dark")
  } else if (darkToggleIcon.attr("class") == darkIconClass) {
    setThemeMode("light")
  }
  location.reload();
});
</script>
<div class="container">
    <div class="row main-top">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>July 23, 2018<br></h4>
            </div>
        </div>
        <div class="col-md-9">
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/article">article</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/sldn">sldn</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/python">python</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-md-12">
            <div class="well well-sm article" style="word-wrap: break-word;">
                <div class="article-title">
                    <h1>Sub-Organization Billing Detail</h1>
                    <small>This tutorial walks you through accessing the steps required to access detailed billing data across sub-organization accounts using a specified date and time range.</small>
                </div>
                
                
                
                <h1 id="sub-org-billing-detail">Sub-org Billing Detail</h1>
<p>This tutorial walks you through accessing the steps required to access detailed billing data across sub-organization accounts using a specified date and time range.</p>
<h2 id="objectives">Objectives</h2>
<p>Understand how to use multiple API services and methods to access detailed billing data for all sub organization accounts for a specified time and date range.</p>
<h2 id="services-used">Services used</h2>
<p>This tutorial uses the following technologies:</p>
<ul>
<li><a href="http://softlayer-python.readthedocs.io/en/latest/">SoftLayer Python Library</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Account">Account Service</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Invoice/">Billing_Invoice Service</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Invoice_Item/">Billing_Invoice_Item Service</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Item/">Billing_item Service</a></li>
</ul>
<h2 id="architecture">Architecture</h2>
<p>Accounts (refered to in this document as a sub account) can be owned by a Brand Account, which is the top level
account type for an organization which can enable sub-organizational level billing.  The API Key for a Brand Account
has access billing data for it&rsquo;s sub accounts. This tutorial demonstrates how to leverage Account, Invoice and Billing
API&rsquo;s to identify invoices accross the multiple sub accounts owned by an organization for a specific range of
dates.  For each invoice, a list of top level billing items are  retreived, such as the billing data for a single
virtual machine.   These top level items, often have detailed sub-billing items such as memory, disk, or cpu which
are also retreived.</p>
<h2 id="install-softlayer-python-library">Install SoftLayer Python Library</h2>
<ul>
<li><a href="https://github.com/softlayer/softlayer-python/blob/master/README.rst">SoftLayer API Python Client Installation</a></li>
</ul>
<h2 id="obtain-a-list-of-invoices-for-all-owned-sub-accounts">Obtain a list of invoices for all owned Sub Accounts</h2>
<p>Using the <a href="https://softlayer.github.io/reference/services/SoftLayer_Account/getObject">getObject</a> method of
the <a href="https://softlayer.github.io/reference/services/SoftLayer_Account">Account</a> class and a nested account mask you can return a list of invoices for all brands owned accounts.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ownedBrands</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="s2">&#34;ownedBrands.allOwnedAccounts.invoices&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>There are several types of invoices which will be returned, for this example the typical invoice type that would be of interest
is the &ldquo;RECURRING&rdquo; type, which includes all the monthly recurring and hourly usage charges incurred on that invoice.</p>
<p>Invoice Types:</p>
<ul>
<li>&ldquo;NEW&rdquo; typeCode signifies an invoice for new service.</li>
<li>&ldquo;RECURRING&rdquo; invoices are generated on an accounts anniversary billing date for monthly services.</li>
<li>&ldquo;ONE-TIME-CHARGE&rdquo; invoices are generated when one-time charges are applied to an account.</li>
<li>&ldquo;CREDIT&rdquo; invoices are generated whenever IBM applies a credit against an account&rsquo;s balance.</li>
</ul>
<p>The list of invoices should then be filtered to include just the specific type of invoices and dates ranges to be
evaluated.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ownedBrands</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="s2">&#34;ownedBrands.allOwnedAccounts.invoices&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">startDate</span> <span class="o">=</span>  <span class="s2">&#34;2018-04-01T00:00:00-06:00&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">endDate</span> <span class="o">=</span>  <span class="s2">&#34;2018-05-01T11:59:59-06:00&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">invoiceType</span> <span class="o">=</span> <span class="s2">&#34;RECURRING&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">invoiceList</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">brand</span> <span class="ow">in</span> <span class="n">ownedBrands</span><span class="p">[</span><span class="s1">&#39;ownedBrands&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">brand</span><span class="p">[</span><span class="s1">&#39;allOwnedAccounts&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">account</span><span class="p">[</span><span class="s1">&#39;invoices&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">invoiceCreateDate</span> <span class="o">=</span> <span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;createDate&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;typeCode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">invoiceType</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">                    <span class="ow">and</span> <span class="p">(</span><span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">invoiceCreateDate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">startDate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                         <span class="ow">and</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">invoiceCreateDate</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">endDate</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">                <span class="n">invoiceInfo</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="n">mask</span><span class="o">=</span><span class="s2">&#34;id,createDate,typeCode,invoiceTotalAmount,invoiceTotalRecurringAmount,invoiceTopLevelItemCount&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">invoiceList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">invoiceInfo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">(</span><span class="n">invoiceList</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="access-invoice-detail">Access invoice detail</h2>
<p>Using the list of invoices returned, use the <a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Invoice/getInvoiceTopLevelItems/">getInvoiceTopLevelItems</a>
method from the <a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Invoice">Billing_Invoice</a> class to obtain the list of top level items being billed on the invoice specified.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">InvoiceList</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">topLevelItems</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getInvoiceTopLevelItems</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="p">(</span><span class="n">topLevelItems</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="access-sub-item-details">Access sub item details</h2>
<p>If additional billing detail is desired for topLevelItems, many items have associated children which have billing details
that make up to the top level item such as memory, storage, or disk.   To access, the details use  <a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Invoice_Item/getNonZeroAssociatedChildren">getNonZeroAssociatedChildren</a> method in the <a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Invoice_Item">Billing_Invoice_Item</a>
class, by passing the id received from the getInvoiceTopLevelItems call.  The method only returns those associated children with a non-zero cost.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">nonZeroAssociatedChildren</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice_Item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getNonZeroAssociatedChildren</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">topLevelItemId</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="sample-script">Sample script</h2>
<p>The following sample script creates a .csv file of all the billing level detail for each owned sub account for the dates specified.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">SoftLayer</span><span class="o">,</span> <span class="nn">argparse</span><span class="o">,</span> <span class="nn">csv</span><span class="o">,</span><span class="nn">logging</span><span class="o">,</span><span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">dateutil.parser</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="n">categoryCode</span><span class="p">,</span> <span class="n">detail</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">detail</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;categoryCode&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;categoryCode&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">categoryCode</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Not Found&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">startDate</span> <span class="o">=</span> <span class="s1">&#39;2018-07-01T00:00:00&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">endDate</span> <span class="o">=</span> <span class="s1">&#39;2018-07-31T23:59:59&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">outputname</span> <span class="o">=</span> <span class="s1">&#39;billing-export.csv&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## OPEN CSV FILE FOR OUTPUT</span>
</span></span><span class="line"><span class="cl"><span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">csvwriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&#34;&#39;</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_ALL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Invoice_Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Account_Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Invoice_Number&#39;</span><span class="p">,</span> <span class="s1">&#39;BillingItemId&#39;</span><span class="p">,</span> <span class="s1">&#39;InstanceType&#39;</span><span class="p">,</span> <span class="s1">&#39;hostName&#39;</span><span class="p">,</span> <span class="s1">&#39;Category&#39;</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="s1">&#39;Hours&#39;</span><span class="p">,</span> <span class="s1">&#39;Hourly_Rate&#39;</span><span class="p">,</span> <span class="s1">&#39;RecurringCharge&#39;</span><span class="p">,</span> <span class="s1">&#39;InvoiceTotal&#39;</span><span class="p">,</span> <span class="s1">&#39;InvoiceRecurring&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">csvwriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">csvwriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">fn</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># GET LIST OF INVOICES FOR ALL BRAND OWNED ACCOUNTS</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Looking up invoices for brand....&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ownedBrands</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Account&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="s2">&#34;ownedBrands.allOwnedAccounts.invoices&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># FILTER INVOICES FOR INVOICETYPE AND DATE RANGE REQUESTED</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">invoiceType</span> <span class="o">=</span> <span class="s2">&#34;RECURRING&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">invoiceList</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">brand</span> <span class="ow">in</span> <span class="n">ownedBrands</span><span class="p">[</span><span class="s1">&#39;ownedBrands&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">brand</span><span class="p">[</span><span class="s1">&#39;allOwnedAccounts&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">account</span><span class="p">[</span><span class="s1">&#39;invoices&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">invoiceCreateDate</span> <span class="o">=</span> <span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;createDate&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;typeCode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">invoiceType</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">                    <span class="ow">and</span> <span class="p">(</span><span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">invoiceCreateDate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">startDate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                         <span class="ow">and</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">invoiceCreateDate</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">endDate</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">                <span class="n">invoiceInfo</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="n">mask</span><span class="o">=</span><span class="s2">&#34;id,createDate,typeCode,invoiceTotalAmount,invoiceTotalRecurringAmount,invoiceTopLevelItemCount&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">invoiceList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">invoiceInfo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## OBTAIN TOP LEVEL DETAIL FROM EACH INVOICE</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;35}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1"> </span><span class="si">{:&gt;8}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&#34;Invoice Date /&#34;</span><span class="p">,</span> <span class="s2">&#34;Account&#34;</span><span class="p">,</span> <span class="s2">&#34;Invoice&#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;Items&#34;</span><span class="p">,</span> <span class="s2">&#34;Recurring Charge&#34;</span><span class="p">,</span>  <span class="s2">&#34;Invoice Amount&#34;</span><span class="p">,</span> <span class="s2">&#34;Type&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{:&lt;35}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1"> </span><span class="si">{:&gt;8}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&#34;==============&#34;</span><span class="p">,</span> <span class="s2">&#34;=======&#34;</span><span class="p">,</span> <span class="s2">&#34;=======&#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;=====&#34;</span><span class="p">,</span> <span class="s2">&#34;================&#34;</span><span class="p">,</span>  <span class="s2">&#34;==============&#34;</span><span class="p">,</span> <span class="s2">&#34;====&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">invoiceList</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">invoiceId</span> <span class="o">=</span> <span class="n">invoice</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">invoiceInfo</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">invoiceId</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="s2">&#34;accountId, id,createDate,typeCode,invoiceTotalAmount,invoiceTotalRecurringAmount,invoiceTopLevelItemCount&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">accountId</span> <span class="o">=</span> <span class="n">invoiceInfo</span><span class="p">[</span><span class="s1">&#39;accountId&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">invoiceDate</span> <span class="o">=</span> <span class="n">invoiceInfo</span><span class="p">[</span><span class="s1">&#39;createDate&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">invoiceTotalAmount</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">invoiceInfo</span><span class="p">[</span><span class="s1">&#39;invoiceTotalAmount&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">invoiceTotalRecurringAmount</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">invoiceInfo</span><span class="p">[</span><span class="s1">&#39;invoiceTotalRecurringAmount&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">invoiceType</span> <span class="o">=</span> <span class="n">invoiceInfo</span><span class="p">[</span><span class="s1">&#39;typeCode&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">totalItems</span><span class="o">=</span><span class="n">invoiceInfo</span><span class="p">[</span><span class="s1">&#39;invoiceTopLevelItemCount&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># PRINT INVOICE SUMMARY LINE</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:35}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1"> </span><span class="si">{:&gt;8}</span><span class="s1"> </span><span class="si">{:&gt;16}</span><span class="s1"> </span><span class="si">{:&gt;16,.2f}</span><span class="s1"> </span><span class="si">{:&gt;16,.2f}</span><span class="s1"> </span><span class="si">{:&lt;15}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invoiceDate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                                          <span class="n">accountId</span><span class="p">,</span> <span class="n">invoiceId</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                                          <span class="n">totalItems</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                                          <span class="n">invoiceTotalAmount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                                          <span class="n">invoiceTotalRecurringAmount</span><span class="p">,</span> <span class="n">invoiceType</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">## set limit of record t</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">totalItems</span><span class="p">,</span><span class="n">limit</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#print (&#34;Lookup at Offset %s&#34; % offset)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">Billing_Invoice</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getInvoiceTopLevelItems</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">invoiceId</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">mask</span><span class="o">=</span><span class="s1">&#39;id, billingItemId, categoryCode, hostName, domainName, description, createDate, totalRecurringAmount,hourlyRecurringFee&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ITERATE THROUGH DETAIL</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Billing_Invoice</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">billingItemId</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;billingItemId&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">category</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&#34;categoryCode&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;hostName&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">hostName</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;hostName&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;.&#34;</span><span class="o">+</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;domainName&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">hostName</span> <span class="o">=</span> <span class="s2">&#34;Unnamed Device&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">recurringFee</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;totalRecurringAmount&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">#IF Monthly calculate hourly rate and total hours</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;hourlyRecurringFee&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">instanceType</span> <span class="o">=</span> <span class="s2">&#34;Hourly&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">associated_children</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="k">while</span> <span class="n">associated_children</span> <span class="ow">is</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">associated_children</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice_Item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getNonZeroAssociatedChildren</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">mask</span><span class="o">=</span><span class="s2">&#34;hourlyRecurringFee&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&#34;getNonZeroAssociatedChildren(): </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">#calculate total hourlyRecurringFree from associated childrent</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">hourlyRecurringFee</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;hourlyRecurringFee&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">&#39;hourlyRecurringFee&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">associated_children</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">hourlyRecurringFee</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">hours</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">recurringFee</span><span class="p">)</span> <span class="o">/</span> <span class="n">hourlyRecurringFee</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">hours</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">instanceType</span> <span class="o">=</span> <span class="s2">&#34;Monthly/Other&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">hourlyRecurringFee</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="n">hours</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">category</span><span class="o">==</span><span class="s2">&#34;storage_service_enterprise&#34;</span> <span class="ow">or</span> <span class="n">category</span><span class="o">==</span><span class="s2">&#34;performance_storage_iscsi&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">billing_detail</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="k">while</span> <span class="n">billing_detail</span> <span class="ow">is</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">billing_detail</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;Billing_Invoice_Item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="s2">&#34;description,categoryCode,product&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">except</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">SoftLayerAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">faultString</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">category</span><span class="o">==</span><span class="s2">&#34;storage_service_enterprise&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">iops</span><span class="o">=</span><span class="n">getDescription</span><span class="p">(</span><span class="s2">&#34;storage_tier_level&#34;</span><span class="p">,</span> <span class="n">billing_detail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">storage</span><span class="o">=</span><span class="n">getDescription</span><span class="p">(</span><span class="s2">&#34;performance_storage_space&#34;</span><span class="p">,</span><span class="n">billing_detail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">snapshot</span><span class="o">=</span><span class="n">getDescription</span><span class="p">(</span><span class="s2">&#34;storage_snapshot_space&#34;</span><span class="p">,</span> <span class="n">billing_detail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">snapshot</span><span class="o">==</span><span class="s2">&#34;Not Found&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">description</span><span class="o">=</span><span class="n">storage</span><span class="o">+</span><span class="s2">&#34; &#34;</span><span class="o">+</span><span class="n">iops</span><span class="o">+</span><span class="s2">&#34; &#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">description</span><span class="o">=</span><span class="n">storage</span><span class="o">+</span><span class="s2">&#34; &#34;</span><span class="o">+</span><span class="n">iops</span><span class="o">+</span><span class="s2">&#34; with &#34;</span><span class="o">+</span><span class="n">snapshot</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">iops</span><span class="o">=</span><span class="n">getDescription</span><span class="p">(</span><span class="s2">&#34;performance_storage_iops&#34;</span><span class="p">,</span> <span class="n">billing_detail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">storage</span><span class="o">=</span><span class="n">getDescription</span><span class="p">(</span><span class="s2">&#34;performance_storage_space&#34;</span><span class="p">,</span> <span class="n">billing_detail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">description</span><span class="o">=</span><span class="n">storage</span><span class="o">+</span><span class="s2">&#34; &#34;</span><span class="o">+</span><span class="n">iops</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># BUILD CSV OUTPUT &amp; WRITE ROW</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Invoice_Date&#39;</span><span class="p">:</span> <span class="n">invoiceDate</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;Account_Id&#39;</span><span class="p">:</span> <span class="n">accountId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;Invoice_Number&#39;</span><span class="p">:</span> <span class="n">invoiceId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;BillingItemId&#39;</span><span class="p">:</span> <span class="n">billingItemId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;InstanceType&#39;</span><span class="p">:</span> <span class="n">instanceType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;hostName&#39;</span><span class="p">:</span> <span class="n">hostName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;Description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;Hours&#39;</span><span class="p">:</span> <span class="n">hours</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;Hourly_Rate&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">hourlyRecurringFee</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;RecurringCharge&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">recurringFee</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;InvoiceTotal&#39;</span><span class="p">:</span> <span class="n">invoiceTotalAmount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;InvoiceRecurring&#39;</span><span class="p">:</span> <span class="n">invoiceTotalRecurringAmount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s1">&#39;Type&#39;</span><span class="p">:</span> <span class="n">invoiceType</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">csvwriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#print(row)</span>
</span></span><span class="line"><span class="cl"><span class="c1">##close CSV File</span>
</span></span><span class="line"><span class="cl"><span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="col-md-6">
    <div class="well well-sm footer" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20article%20-%20Sub-Organization%20Billing%20Detail&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2farticle%2fsub-org-billing-detail%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
                <span> - </span>
                <a class="" href="https://github.com/softlayer/githubio_source/edit/master/content/article/article/sub-org-billing-detail.md.md" style="text-align: right;"> Quick Edit</a>
                <i class="fab fa-github" alt="github"></i>

            </p>
    </div>
</div>

    </div>
<footer>
    <div class="row">
        <div class="col-sm-12 footer">
            <p>&copy; SoftLayer 2024<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>

