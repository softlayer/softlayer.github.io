<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>VLAN Trunking - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/article/vlanTrunking/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">
    

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
        var head = document.getElementsByTagName('head')[0]
        var style = document.createElement('link')
        style.type = 'text/css'
        style.rel = 'stylesheet'
        style.id = "dark-theme"
        if (localStorage.getItem("dark-mode-theme") == "dark") {
            style.href = '/css/dark.css'
        } else {
            style.href = '/css/light.css'
        }
        head.append(style)
    </script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
            setThemeMode(localStorage.getItem("dark-mode-theme") || "dark");
		})
	</script>
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9XPZ9ZBSJE"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-9XPZ9ZBSJE');
        }
      </script>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="nav-container">
            <div class="navbar-header" style="width: 150px">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>

            <div class="navbar-header" style="width: calc(100% - 350px)">
                <ul class="nav navbar-nav" style="width: 100%">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Docs</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    
                    <li class="nav-item">
                        <a id="dark-toggle" class="dark-mode-toggle" aria-label="dark-mode-toggle" style="color: var(--Red); font-size: 20px">
                            <i class="fas fa-sun"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <div id="custom-search-input" class="pull-right" style="width: 200px">
              <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                <div class="input-group col-md-12">
                  <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                  <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                  <div class="input-group-btn">
                    <button class="btn btn-info" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>

        </div>
    </nav>

<script type="text/javascript">
const darkIconClass = 'fas fa-moon'
const lightIconClass = 'fas fa-sun'
var darkCSS = $("#dark-theme");
var darkToggleIcon = $("#dark-toggle i");




function setThemeMode(mode) {
    localStorage.setItem("dark-mode-theme", mode);
    if (mode === "dark") {
        darkToggleIcon.attr('class', darkIconClass)
    } else  {
        darkToggleIcon.attr('class', lightIconClass)
    }
}


$("#dark-toggle").click(function () {
  if (darkToggleIcon.attr("class") == lightIconClass) {
    setThemeMode("dark")
  } else if (darkToggleIcon.attr("class") == darkIconClass) {
    setThemeMode("light")
  }
  location.reload();
});
</script>
<div class="container">
    <div class="row main-top">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>December 18, 2023<br></h4>
            </div>
        </div>
        <div class="col-md-9">
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/article">article</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/sldn">sldn</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/vlan">vlan</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-md-12">
            <div class="well well-sm article" style="word-wrap: break-word;">
                <div class="article-title">
                    <h1>VLAN Trunking</h1>
                    <small>An explanation of how to trunk vlans with the CLI so servers can have access to more than their native VLANs</small>
                </div>
                
                
                
                <h1 id="basics-of-vlan-trunking">Basics of VLAN Trunking</h1>
<p>Trunking VLANs allows you to enable bare metal servers that are in the same POD, but on different primary VLANs, to be able to communicate as if they were on the same VLAN. So if you have <code>Server1</code> on <code>VLAN1</code>, and <code>Server2</code> on <code>VLAN2</code> (in the same POD), you could trunk <code>VLAN2</code> to <code>Server1</code>&rsquo;s switch port allowing <code>Server1</code> to communicate on <code>VLAN2</code>.</p>
<p>This article will explain how to do that with the CLI and API tools. See <a href="https://cloud.ibm.com/docs/vlans?topic=vlans-configuring-vlan-trunks&amp;interface=ui">Configuring VLAN trunks</a> for how to use the UI to do this.
<a href="https://cloud.ibm.com/docs/bare-metal?topic=bare-metal-network-options#bare-metal-vlan-trunks">VLAN Trunks</a> has some additional information on this topic as well.</p>
<p>The CLI commands were added in <a href="https://github.com/softlayer/softlayer-cli/releases/tag/v1.5.0">ibmcloud sl v1.5.0</a> and <a href="https://github.com/softlayer/softlayer-python/releases/tag/v6.1.11">slcli v6.1.11</a></p>
<h1 id="view-available-vlans">View Available VLANs</h1>
<p>The first thing to do is figure out which VLANs a server is able to have trunked to it. For this we will use the <code>hardware vlan-trunkable &lt;hardware-id&gt;</code> command. It will list all the VLANs available to be trunked to this specific server. In this case we can trunk the Private vlan <code>1632</code> or the Public vlan <code>1163</code> to server <code>1907356</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ibmcloud sl hardware vlan-trunkable <span class="m">1907356</span>
</span></span><span class="line"><span class="cl">Id        Fully qualified name   Name                 Network
</span></span><span class="line"><span class="cl"><span class="m">1404269</span>   dal10.bcr01.1632       iSCSI DAL10          PRIVATE
</span></span><span class="line"><span class="cl"><span class="m">2282899</span>   dal10.fcr01.1163       fmirPublic           PUBLIC
</span></span></code></pre></div><p>To get this information from the API, it can be found in the <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Hardware_Server/">Hardware_Server</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component/">networkComponents</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component/#networkVlansTrunkable">networkVLansTrunkable</a> property.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -u <span class="nv">$SL_USER</span>:<span class="nv">$SL_APIKEY</span> https://api.softlayer.com/rest/v3.1/SoftLayer_Hardware_Server/1907356.json?objectMask<span class="o">=</span>mask<span class="o">[</span>networkComponents<span class="o">[</span>id,name,port,macAddress,primaryIpAddress,networkVlansTrunkable<span class="o">[</span>id,name,vlanNumber,fullyQualifiedName,networkSpace<span class="o">]]]</span>
</span></span></code></pre></div><h2 id="vlans-on-a-server">Vlans on a server</h2>
<p>To see which VLANs a server has access to, use the <code>hardware detail</code> command.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ibmcloud.exe  sl hardware detail <span class="m">1907356</span>
</span></span><span class="line"><span class="cl">Name               Value
</span></span><span class="line"><span class="cl">ID                 <span class="m">1907356</span>
</span></span><span class="line"><span class="cl">GUID               ec3a60fc-fb36-46a7-8d25-76751d504cca
</span></span><span class="line"><span class="cl">Hostname           testibm
</span></span><span class="line"><span class="cl">Vlans              Network   Number   ID        Name               Type
</span></span><span class="line"><span class="cl">                   PRIVATE   <span class="m">777</span>      <span class="m">3029822</span>   dal10.bcr01.777    Primary
</span></span><span class="line"><span class="cl">                   PUBLIC    <span class="m">2188</span>     <span class="m">3029824</span>   dal10.fcr01.2188   Primary
</span></span><span class="line"><span class="cl">                   PUBLIC    <span class="m">1455</span>     <span class="m">1404267</span>   dal10.fcr01.1455   Trunked
</span></span><span class="line"><span class="cl">                   PUBLIC    <span class="m">974</span>      <span class="m">3249384</span>   dal10.fcr01.974    Trunked
</span></span></code></pre></div><p>The Primary VLANs are avilable from the <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Hardware_Server">Hardware_Server</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Hardware_Server/#networkVlans">networkVlans</a> property. The Trunked VLANs are associated with the server&rsquo;s switch port&rsquo;s networkComponent, so you need to request the <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Hardware_Server">Hardware_Server</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component/#uplinkComponent">uplinkComponent</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component/#networkVlanTrunks">networkVlanTrunks</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Vlan/">networkVlan</a> property in your object mask when making API requests.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -u <span class="nv">$SL_USER</span>:<span class="nv">$SL_APIKEY</span> <span class="s1">&#39;https://api.softlayer.com/rest/v3.1/SoftLayer_Hardware_Server/1907356/getNetworkComponents.json?objectMask=mask[id,uplinkComponent[networkVlanTrunks[networkVlan[networkSpace]]]]&#39;</span>
</span></span></code></pre></div><h2 id="servers-on-a-vlan">Servers on a VLAN</h2>
<p>If you want to see which servers are on a VLAN, the <code>vlan detail</code> command will show that information.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ibmcloud sl  vlan  detail <span class="m">1404267</span>
</span></span><span class="line"><span class="cl">Name              Value
</span></span><span class="line"><span class="cl">id                <span class="m">1404267</span>
</span></span><span class="line"><span class="cl">number            <span class="m">1455</span>
</span></span><span class="line"><span class="cl">datacenter        Dallas <span class="m">10</span>
</span></span><span class="line"><span class="cl">primary_router    fcr01a.dal10.softlayer.com
</span></span><span class="line"><span class="cl">hardware          Hostname       domain           public_ip       private_ip
</span></span><span class="line"><span class="cl">                  testibm        sldn.testcloud   52.118.38.246   10.221.68.227
</span></span></code></pre></div><p>For servers that have <code>VLAN 1455</code> as thir primary VLAN, they will show up on the <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Vlan">Network_Vlan</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Vlan/#hardware">hardware</a> property. Finding servers that are trunked into the vlan is slightly convoluted.</p>
<p><a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Vlan">Network_Vlan</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Vlan/#networkComponentTrunks">networkComponentTrunks</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component_Network_Vlan_Trunk/#networkComponent">networkComponent</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component/#downlinkComponent">downlinkComponent</a>-&gt;<a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Component/#hardware">hardware</a>
To explain the logic here, a Network_Vlan will have network components trunked to it. These networkComponentTrunks link to a networkComponent, which is the actual switch port the server is connected to. The downlinkComponent from there is the physical network card on the server, which is what the hardware property links to.</p>
<p>An example API call to get all that information:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -u <span class="nv">$SL_USER</span>:<span class="nv">$SL_APIKEY</span> <span class="s1">&#39;https://api.softlayer.com/rest/v3.1/SoftLayer_Network_Vlan/1404267/getObject.json?objectMask=mask[primaryRouter[id,fullyQualifiedDomainName,datacenter],hardware,virtualGuests,networkComponentTrunks[networkComponent[downlinkComponent[networkComponentGroup[membersDescription],hardware[tagReferences]]]]]&#39;</span>
</span></span></code></pre></div><h1 id="adding-and-removing-a-vlan">Adding and Removing a VLAN</h1>
<p>To add or remove a vlan from a server, you can use the <code>hardware vlan-add &lt;SERVER_ID&gt; &lt;VLAN_ID&gt;...</code>  and  <code>hardware vlan-remove &lt;SERVER_ID&gt; &lt;VLAN_ID&gt;...</code> commands.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$&gt; ibmcloud sl hardware vlan-add     <span class="m">1907356</span> <span class="m">1404267</span>
</span></span><span class="line"><span class="cl">$&gt; ibmcloud sl hardware vlan-remove  <span class="m">1907356</span> <span class="m">1404267</span>
</span></span></code></pre></div><p>The API this command uses is <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Component/addNetworkVlanTrunks/">SoftLayer_Network_Component::addNetworkVlanTrunks()</a> or <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Network_Component/removeNetworkVlanTrunks/">SoftLayer_Network_Component::removeNetworkVlanTrunks()</a>.
That API takes an <a href="https://sldn.softlayer.com/article/using-initialization-parameters-softlayer-api/">init parameter</a> which is the ID of the appropriate network component attached to the server (the network card&rsquo;s component, not the switch port component which is what you would use when getting the vlan trunks).
If you are trunking a public vlan, use <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/getFrontendNetworkComponents/">SoftLayer_Hardware_Server::getFrontendNetworkComponents(id=1907356, mask=&lsquo;mask[id, name, port, macAddress, primaryIpAddress]&rsquo;)</a> and for private vlans, use <a href="https://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/getBackendNetworkComponents/">SoftLayer_Hardware_Server::getBackendNetworkComponents(id=1907356, mask=&lsquo;mask[id, name, port, macAddress, primaryIpAddress]&rsquo;)</a>. Servers will usually have 2 network components for public and private, so make sure to use the ID of the component that has a primaryIpAddress defined.</p>
<p>Once you have the component id, you just need to call the removeNetworkVlanTrunks API and pass in the id of the vlans you want to remove. If you need to remove multiple vlans at once, make sure to pass them all in a single API call. Otherwise you will need to wait for the removal transaction to finish before removing another VLAN.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -u <span class="nv">$SL_USER</span>:<span class="nv">$SL_APIKEY</span> -X POST <span class="s1">&#39;{&#34;parameters&#34;: [[{&#34;id&#34;: 1404267}]]}&#39;</span> <span class="s1">&#39;https://api.softlayer.com/rest/v3.1/SoftLayer_Network_Component/13765658/addNetworkVlanTrunks.json&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl -u <span class="nv">$SL_USER</span>:<span class="nv">$SL_APIKEY</span> -X POST <span class="s1">&#39;{&#34;parameters&#34;: [[{&#34;id&#34;: 1404267}]]}&#39;</span> <span class="s1">&#39;https://api.softlayer.com/rest/v3.1/SoftLayer_Network_Component/13765658/removeNetworkVlanTrunks.json&#39;</span>
</span></span></code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="col-md-6">
    <div class="well well-sm footer" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20article%20-%20VLAN%20Trunking&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2farticle%2fvlanTrunking%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
                <span> - </span>
                <a class="" href="https://github.com/softlayer/githubio_source/edit/master/content/article/vlanTrunking.md" style="text-align: right;"> Quick Edit</a>
                <i class="fab fa-github" alt="github"></i>

            </p>
    </div>
</div>

    </div>
<footer>
    <div class="row">
        <div class="col-sm-12 footer">
            <p>&copy; SoftLayer 2025<br>
            Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
        </div>
    </div>
</footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>

